<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Soil water balance at Font-Blanche • medfate</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Soil water balance at Font-Blanche">
<meta property="og:description" content="medfate">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">medfate</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.3.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li>
  <a href="../../articles/index.html">Articles</a>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/emf-creaf/medfate/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="FontBlanche_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Soil water balance at Font-Blanche</h1>
                        <h4 class="author">Miquel De Caceres (CREAF), Nicolas Martin-StPaul (INRA)</h4>
            
            <h4 class="date">2021-11-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/medfate/blob/master/vignettes/workedexamples/FontBlanche.Rmd"><code>vignettes/workedexamples/FontBlanche.Rmd</code></a></small>
      <div class="hidden name"><code>FontBlanche.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<div id="about-this-vignette" class="section level3">
<h3 class="hasAnchor">
<a href="#about-this-vignette" class="anchor"></a>About this vignette</h3>
<p>This document describes how to run the soil water balance model on a forest plot at Font-Blanche (France), using the R function <code><a href="../../reference/spwb.html">spwb()</a></code> included in package <code>medfate</code>. The document indicates how to prepare the model inputs, use the model simulation function and inspect the outputs.</p>
</div>
<div id="about-the-font-blanche-forest" class="section level3">
<h3 class="hasAnchor">
<a href="#about-the-font-blanche-forest" class="anchor"></a>About the Font-Blanche forest</h3>
<p>The Font-Blanche research forest, located in southeastern France (43º14′27″ N 5°40′45″ E, 420 m elevation), is composed of a top strata of <em>Pinus halepensis</em> (Aleppo pine) reaching about 12 m, a lower strata of <em>Quercus ilex</em> (holm oak), reaching about 6 m, and an understorey strata dominated by <em>Quercus coccifera</em>. It is spatially heterogeneous: not all trees in each strata are contiguous, so trees from the lower stratas are partially exposed to direct light. The forest grows on rocky and shallow soils that have a low retention capacity and are of Jurassic limestone origin. The climate is Mediterranean, with a water stress period in summer, cold or mild winters and most precipitation occurring between September and May. The experimental site, which is dedicated to study forest carbon and water cycles, has an enclosed area of 80×80 m (Simioni et al. 2013) but our specific plot is a quadrat of dimensions 25x25 m.</p>
</div>
</div>
<div id="model-inputs" class="section level2">
<h2 class="hasAnchor">
<a href="#model-inputs" class="anchor"></a>Model inputs</h2>
<p>Any forest water balance model needs information on <strong>climate</strong>, <strong>vegetation</strong> and <strong>soils</strong> of the forest stand to be simulated. Moreover, since the soil water balance in <code>medfate</code> differentiates between species, <strong>species-specific parameters</strong> are also needed. Since FontBlance is one of the sites used for evaluating the model, we can use a data list <code>fb</code> with all the necessary inputs:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb</span> <span class="op">&lt;-</span> <span class="fu">medfatereports</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/medfatereports/man/load_forest.html">load_list</a></span><span class="op">(</span><span class="st">"FONBLA"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"fb_data.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html">names</a></span><span class="op">(</span><span class="va">fb</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "treeData"       "shrubData"      "customParams"   "measuredData"  
##  [5] "meteoData"      "miscData"       "soilData"       "terrainData"   
##  [9] "remarks"        "sp_params"      "forest_object1"</code></pre>
<div id="soil" class="section level3">
<h3 class="hasAnchor">
<a href="#soil" class="anchor"></a>Soil</h3>
<p>We require information on the physical attributes of soil in FontBlanche, namely <em>soil depth</em>, <em>texture</em>, <em>bulk density</em> and <em>rock fragment content</em>. Soil information needs to be entered as a <code>data frame</code> with soil layers in rows and physical attributes in columns. The model accepts one to five soil layers with arbitrary widths. Because soil properties vary strongly at fine spatial scales, ideally soil physical attributes should be measured on samples taken at the forest stand to be simulated. For those users lacking such data, soil properties modelled at larger scales are available via soilgrids.org (see function <code><a href="https://rdrr.io/pkg/medfateutils/man/soilgridsParams.html">soilgridsParams()</a></code>). In our case soil physical attributes are already defined in the data bundled for FontBlanche:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spar</span> <span class="op">&lt;-</span> <span class="va">fb</span><span class="op">$</span><span class="va">soilData</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">spar</span><span class="op">)</span></code></pre></div>
<pre><code>##   widths clay sand om   bd rfc
## 1    300   39   26  6 1.45  50
## 2    700   39   26  3 1.45  65
## 3   1000   39   26  1 1.45  85
## 4   2500   39   26  1 1.45  90</code></pre>
<p>The soil input for function <code><a href="../../reference/spwb.html">spwb()</a></code> is actually an object of class <code>soil</code> that is created using a function with the same name:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb_soil</span> <span class="op">=</span> <span class="fu"><a href="../../reference/soil.html">soil</a></span><span class="op">(</span><span class="va">spar</span><span class="op">)</span></code></pre></div>
<p>The <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> function for objects <code>soil</code> provides a lot of information on soil physical properties and water capacity:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fb_soil</span><span class="op">)</span></code></pre></div>
<pre><code>## Soil depth (mm): 4500 
## 
## Layer  1  [ 0  to  300 mm ] 
##     clay (%): 39 silt (%): 29 sand (%): 26 organic matter (%): 6 [ Clay loam ]
##     Rock fragment content (%): 50 Macroporosity (%): 7 
##     Theta WP (%): 25 Theta FC (%): 39 Theta SAT (%): 54 Theta current (%) 39 
##     Vol. WP (mm): 37 Vol. FC (mm): 58 Vol. SAT (mm): 81 Vol. current (mm): 58 
##     Temperature (Celsius): NA 
## 
## Layer  2  [ 300  to  1000 mm ] 
##     clay (%): 39 silt (%): 32 sand (%): 26 organic matter (%): 3 [ Clay loam ]
##     Rock fragment content (%): 65 Macroporosity (%): 7 
##     Theta WP (%): 24 Theta FC (%): 38 Theta SAT (%): 49 Theta current (%) 38 
##     Vol. WP (mm): 59 Vol. FC (mm): 93 Vol. SAT (mm): 121 Vol. current (mm): 93 
##     Temperature (Celsius): NA 
## 
## Layer  3  [ 1000  to  2000 mm ] 
##     clay (%): 39 silt (%): 34 sand (%): 26 organic matter (%): 1 [ Clay loam ]
##     Rock fragment content (%): 85 Macroporosity (%): 7 
##     Theta WP (%): 24 Theta FC (%): 37 Theta SAT (%): 47 Theta current (%) 37 
##     Vol. WP (mm): 35 Vol. FC (mm): 56 Vol. SAT (mm): 70 Vol. current (mm): 56 
##     Temperature (Celsius): NA 
## 
## Layer  4  [ 2000  to  4500 mm ] 
##     clay (%): 39 silt (%): 34 sand (%): 26 organic matter (%): 1 [ Clay loam ]
##     Rock fragment content (%): 90 Macroporosity (%): 7 
##     Theta WP (%): 24 Theta FC (%): 37 Theta SAT (%): 47 Theta current (%) 37 
##     Vol. WP (mm): 59 Vol. FC (mm): 93 Vol. SAT (mm): 116 Vol. current (mm): 93 
##     Temperature (Celsius): NA 
## 
## Total soil saturated capacity (mm): 388 
## Total soil water holding capacity (mm): 300 
## Total soil extractable water (mm): 136 
## Total soil current Volume (mm): 300 
## 
## Snow pack water equivalent (mm): 0 
## Soil water table depth (mm): 4500</code></pre>
<p>The soil object is also used to store the moisture degree of each soil layer. In particular, <code>W</code> contains the state variable that represents moisture content - the proportion of moisture <strong>relative to field capacity</strong> - which is by default initialized to 1 for each layer:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb_soil</span><span class="op">$</span><span class="va">W</span></code></pre></div>
<pre><code>## [1] 1 1 1 1</code></pre>
</div>
<div id="species-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#species-parameters" class="anchor"></a>Species parameters</h3>
<p>Simulation models in <code>medfate</code> require a data frame with species parameter values. The package provides a default data set of parameter values for a number of Mediterranean species occurring in Spain (rows), resulting from bibliographic search, fit to empirical data or expert-based guesses:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"SpParamsMED"</span><span class="op">)</span></code></pre></div>
<p>However, sometimes one may wish to override species defaults with custom values. In the case of FontBlanche there is a table of preferred parameters:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb</span><span class="op">$</span><span class="va">customParams</span></code></pre></div>
<pre><code>##   SpIndex Cohort   g Kmax_stemxylem VCleaf_kmax VCleaf_c VCleaf_d LeafPI0
## 1     142 T1_142 0.8             NA        3.00       NA       NA      NA
## 2     148 T2_148 1.0             NA        4.00       NA       NA      NA
## 3     168 T3_168 0.8            0.4        2.63     5.41    -4.18   -2.66
##   LeafEPS LeafAF    Al2As
## 1      NA     NA       NA
## 2      NA     NA  631.000
## 3   10.57   0.43 1540.671</code></pre>
<p>We can use function <code><a href="../../reference/modifyParams.html">modifySpParams()</a></code> to replace the values of parameters for the desired traits, leaving the rest unaltered:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SpParamsFB</span> <span class="op">=</span> <span class="fu"><a href="../../reference/modifyParams.html">modifySpParams</a></span><span class="op">(</span><span class="va">SpParamsMED</span>, <span class="va">fb</span><span class="op">$</span><span class="va">customParams</span><span class="op">)</span>
<span class="va">SpParamsFB</span></code></pre></div>
<pre><code>##                    Name IFNcodes SpIndex     Genus    Order   Family      Group
## 143 Phillyrea latifolia        8     142 Phillyrea Lamiales Oleaceae Angiosperm
## 149    Pinus halepensis       24     148     Pinus  Pinales Pinaceae Gymnosperm
## 169        Quercus ilex   45/245     168   Quercus  Fagales Fagaceae Angiosperm
##     GrowthForm     LifeForm LeafShape LeafSize      PhenologyType Hmed Hmax Z50
## 143       Tree Phanerophyte     Broad   Medium oneflush-evergreen  150  970  NA
## 149       Tree Phanerophyte    Needle    Small oneflush-evergreen  850 1900  NA
## 169 Tree/Shrub Phanerophyte     Broad   Medium oneflush-evergreen  550 1300  NA
##      Z95 fHDmin fHDmax    a_ash    b_ash    a_bsh     b_bsh    a_btsh   b_btsh
## 143 2397     40    160       NA       NA       NA        NA        NA       NA
## 149 7500     26    100       NA       NA       NA        NA        NA       NA
## 169 5020     16    160 1.857486 1.885548 0.523883 0.7337293 0.7327147 0.737577
##     cr      a_fbt    b_fbt        c_fbt d_fbt    a_cr  b_1cr    b_2cr
## 143 NA         NA       NA           NA    NA      NA     NA       NA
## 149 NA 0.05684887 1.521218 -0.024946517     0      NA     NA       NA
## 169 NA 0.06310630 1.545032 -0.005288476     0 1.98539 -0.552 -0.01386
##            b_3cr    c_1cr    c_2cr      a_cw   b_cw LeafDuration t0gdd  Sgdd
## 143           NA       NA       NA        NA     NA     2.556345    NA    NA
## 149           NA       NA       NA 0.6415296 0.7310     2.536875    NA    NA
## 169 -0.000110736 -0.00685 -0.20101 0.5681897 0.7974     2.145402  54.5 240.7
##     Tbgdd  Ssen Phsen Tbsen xsen ysen      SLA LeafDensity WoodDensity
## 143    NA    NA    NA    NA   NA   NA 6.881886   0.5327417   0.7050000
## 149    NA    NA    NA    NA   NA   NA 5.348269   0.3237865   0.6064556
## 169  4.34 10178  12.5  28.5    2    2 6.817833   0.5272863   0.8743066
##     FineRootDensity conduit2sapwood     r635    pDead    Al2As LeafWidth
## 143              NA              NA 1.917579 0.119768 1425.966  1.200000
## 149              NA       0.9236406 1.964226 0.000500  631.000  0.700000
## 169              NA       0.6238125 1.805872 0.000260 1540.671  1.767436
##          SRL RLD    maxFMC   minFMC   LeafPI0   LeafEPS LeafAF StemPI0 StemEPS
## 143       NA  NA 108.24724 56.53442        NA        NA     NA      NA      NA
## 149 3172.572  NA 126.03063 86.22550 -1.591429  8.918571 0.3525      NA      NA
## 169 4066.803  NA  93.15304 57.44192 -2.660000 10.570000 0.4300      NA      NA
##     StemAF  SAV HeatContent LigninPercent gammaSWR alphaSWR kPAR   g Tmax_LAI
## 143     NA 9630       21400            NA       NA       NA   NA 0.8       NA
## 149     NA 6050       22150      24.52473       NA       NA   NA 1.0       NA
## 169     NA 4050       19300      28.97492       NA       NA   NA 0.8       NA
##     Tmax_LAIsq Psi_Extract Psi_Critic      WUE pRootDisc      Gswmin    Gswmax
## 143         NA   -3.090000  -6.489351       NA        NA          NA        NA
## 149         NA   -2.600000  -3.816852 3.613308        NA 0.002031250 0.1940833
## 169         NA   -3.001667  -3.001667 1.475715        NA 0.006003126 0.2007222
##     VCleaf_kmax VCleaf_c VCleaf_d Kmax_stemxylem VCstem_c  VCstem_d
## 143        3.00       NA       NA      0.4083769 2.619333 -7.533736
## 149        4.00       NA       NA      0.1500000 7.458883 -4.481392
## 169        2.63     5.41    -4.18      0.4000000 2.558358 -5.103492
##     Kmax_rootxylem VCroot_c VCroot_d    Narea  Vmax298  Jmax298     WoodC
## 143             NA       NA       NA 1.849868 65.23250 146.2701        NA
## 149             NA       NA       NA 2.663411 62.81613 128.8272 0.4978954
## 169             NA       NA       NA 2.308605 39.24539 103.0690 0.4740096
##     RERleaf RERsapwood RERfineroot RGRleafmax RGRsapwoodmax RGRfinerootmax
## 143      NA         NA          NA         NA            NA             NA
## 149      NA         NA          NA         NA            NA             NA
## 169      NA         NA          NA         NA            NA             NA
##     SRsapwood SRfineroot SeedProductionHeight RecrTreeDBH RecrTreeHeight
## 143        NA         NA                   NA          NA             NA
## 149        NA         NA                   NA          NA             NA
## 169        NA         NA                   NA          NA             NA
##     RecrShrubHeight RecrTreeDensity RecrShrubCover RecrZ50 RecrZ95 MinTempRecr
## 143              NA              NA             NA      NA      NA    1.231819
## 149              NA              NA             NA      NA      NA    2.035703
## 169              NA              NA             NA      NA      NA    0.405868
##     MinMoistureRecr MinFPARRecr
## 143       0.3464240   0.1008915
## 149       0.2022525   0.9410013
## 169       0.2860409   0.3104976</code></pre>
<p>Note that the function returns a subset of rows for the species mentioned in <code>customParams</code>. Not all parameters are needed for the soil water balance model. The user can find parameter definitions in the help page of this data set. However, to fully understand the role of parameters in the model, the user should read the details of model design and formulation (<a href="http://emf-creaf.github.io/medfate" class="uri">http://emf-creaf.github.io/medfate</a>).</p>
</div>
<div id="vegetation" class="section level3">
<h3 class="hasAnchor">
<a href="#vegetation" class="anchor"></a>Vegetation</h3>
<p>Models included in <code>medfate</code> were primarily designed to be ran on <strong>forest inventory plots</strong>. In this kind of data, the vegetation of a sampled area is described in terms of woody plants (trees and shrubs) along with their size and species identity. Forest plots in <code>medfate</code> are assumed to be in a format that follows closely the Spanish forest inventory. Each forest plot is represented in an object of class <code>forest</code>, a list that contains several elements. Among them, the most important items are two data frames, <code>treeData</code> (for trees) and <code>shrubData</code> for shrubs:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb_forest</span> <span class="op">=</span> <span class="fu"><a href="../../reference/forest.html">emptyforest</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">fb_forest</span></code></pre></div>
<pre><code>## $ID
## [1] ""
## 
## $patchsize
## [1] 10000
## 
## $treeData
## [1] Species DBH     Height  N       Z50     Z95    
## &lt;0 rows&gt; (or 0-length row.names)
## 
## $shrubData
## [1] Species Height  Cover   Z50     Z95    
## &lt;0 rows&gt; (or 0-length row.names)
## 
## $herbCover
## [1] 0
## 
## $herbHeight
## [1] 0
## 
## attr(,"class")
## [1] "forest" "list"</code></pre>
<p>Trees are expected to be primarily described in terms of species, diameter (DBH) and height, whereas shrubs are described in terms of species, percent cover and mean height. In our case, we will for simplicity avoid shrubs and concentrate on the main three tree species in the Font-Blanche forest plot: <em>Phillyrea latifolia</em> (code 53), <em>Pinus halepensis</em> (Alepo pine, code 54), and <em>Quercus ilex</em> (holm oak; code 68). In order to run the model, one has to prepare a data table like this one, already prepared for Font-Blanche:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb</span><span class="op">$</span><span class="va">treeData</span></code></pre></div>
<pre><code>##   Species       DBH    Height    N      Z50      Z95
## 1     142 26.759914 1195.7667  256 496.3295 2036.165
## 2     148  2.587859  323.0000 1248 623.3133 4000.000
## 3     168  6.220031  495.5532 3104 665.2510 4000.000</code></pre>
<p>Trees have been grouped by species, so DBH and height values are means (in cm), and <code>N</code> indicates the number of trees in each category. Package <code>medfate</code> allows separating trees by size, but for simplicity we do not distinguish here between tree sizes within each species. Columns <code>Z50</code> and <code>Z95</code> indicate the depths (in mm) corresponding to cumulative 50% and 95% of fine roots, respectively.</p>
<p>In order to use this data, we need to replace the part corresponding to trees into the forest object that we created before:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb_forest</span><span class="op">$</span><span class="va">treeData</span> <span class="op">=</span> <span class="va">fb</span><span class="op">$</span><span class="va">treeData</span>
<span class="va">fb_forest</span></code></pre></div>
<pre><code>## $ID
## [1] ""
## 
## $patchsize
## [1] 10000
## 
## $treeData
##   Species       DBH    Height    N      Z50      Z95
## 1     142 26.759914 1195.7667  256 496.3295 2036.165
## 2     148  2.587859  323.0000 1248 623.3133 4000.000
## 3     168  6.220031  495.5532 3104 665.2510 4000.000
## 
## $shrubData
## [1] Species Height  Cover   Z50     Z95    
## &lt;0 rows&gt; (or 0-length row.names)
## 
## $herbCover
## [1] 0
## 
## $herbHeight
## [1] 0
## 
## attr(,"class")
## [1] "forest" "list"</code></pre>
<p>Because the forest plot format is rather specific, <code>medfate</code> also allows starting in an alternative way using two data frames, one with <strong>aboveground</strong> information (i.e. the leave area and size of plants) and the other with <strong>belowground</strong> information (i.e. root distribution). The aboveground data frame does not distinguish between trees and shrubs. It includes, for each plant cohort to be considered in rows, its <em>species identity</em>, <em>height</em>, <em>leaf area index</em> (LAI) and <em>crown ratio</em>. While users can build their input data themselves, we use function <code><a href="../../reference/modelInput.html">forest2aboveground()</a></code> on the object <code>fb_forest</code> to show how should the data look like:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb_above</span> <span class="op">=</span> <span class="fu"><a href="../../reference/modelInput.html">forest2aboveground</a></span><span class="op">(</span><span class="va">fb_forest</span>, <span class="va">SpParamsFB</span><span class="op">)</span>
<span class="va">fb_above</span></code></pre></div>
<pre><code>##         SP    N       DBH Cover         H        CR LAI_live LAI_expanded
## T1_142 142  256 26.759914    NA 1195.7667 0.5832988 1.804312     1.804312
## T2_148 148 1248  2.587859    NA  323.0000 0.5241391 0.088225     0.088225
## T3_168 168 3104  6.220031    NA  495.5532 0.5425664 2.033179     2.033179
##        LAI_dead
## T1_142        0
## T2_148        0
## T3_168        0</code></pre>
<p>Note that the call to <code><a href="../../reference/modelInput.html">forest2aboveground()</a></code> included species parameters, because species-specific parameter values are needed to calculate leaf area from tree diameters or shrub cover using allometric relationships. Columns <code>N</code>, <code>DBH</code> and <code>Cover</code> are required for simulating growth, but not for soil water balance, which only requires columns <code>SP</code>, <code>H</code> (in cm), <code>CR</code> (i.e. the crown ratio), <code>LAI_live</code>, <code>LAI_expanded</code> and <code>LAI_dead</code>. Here plant cohorts are given unique codes that tell us whether they correspond to trees or shrubs. In practice, the user only needs to worry to calculate the values for <code>LAI_live</code>. <code>LAI_live</code> and <code>LAI_expanded</code> can contain the same LAI values, and <code>LAI_dead</code> is normally zero.</p>
<p>We see that at Font-Blanche holm oaks (code 68) represent most of the total leaf area. On the other hand, pines are taller than oaks. <code>medfate</code> assumes that leaf distribution follows a truncated normal curve between the crown base height and the total height. This can be easily inspected using function <code><a href="../../reference/Vertical%20profiles.html">vprofile_leafAreaDensity()</a></code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/Vertical%20profiles.html">vprofile_leafAreaDensity</a></span><span class="op">(</span><span class="va">fb_forest</span>, <span class="va">SpParamsFB</span>, byCohorts <span class="op">=</span> <span class="cn">T</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-14-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Regarding <strong>belowground</strong> information, the usuer should supply a matrix describing for each plant cohort, the proportion of fine roots in each soil layer. As before, we use function <code><a href="../../reference/modelInput.html">forest2belowground()</a></code> on the object <code>fb_forest</code> to show how should the data look like:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb_below</span> <span class="op">=</span> <span class="fu"><a href="../../reference/modelInput.html">forest2belowground</a></span><span class="op">(</span><span class="va">fb_forest</span>, <span class="va">fb_soil</span><span class="op">)</span>
<span class="va">fb_below</span></code></pre></div>
<pre><code>##                1         2         3          4
## T1_142 0.2621273 0.5574782 0.1379818 0.04241272
## T2_148 0.2498057 0.4586259 0.1928516 0.09871682
## T3_168 0.2225891 0.4672786 0.2061914 0.10394089</code></pre>
<p>In our case, these proportions were implicitly specified in parameters <code>Z50</code> and <code>Z95</code>. In fact, these values describe a continuous distribution of fine roots along depth, which can be displayed using function <code><a href="../../reference/Vertical%20profiles.html">vprofile_rootDistribution()</a></code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/Vertical%20profiles.html">vprofile_rootDistribution</a></span><span class="op">(</span><span class="va">fb_forest</span>, <span class="va">SpParamsFB</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-16-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Note that in Font-Blanche we set that the root system of Aleppo pines (<em>Pinus halepensis</em>) would be more superficial than that of the other two species. Moreover, holm oak trees are the ones who extend their roots down to deepest soil layers.</p>
</div>
<div id="meteorology" class="section level3">
<h3 class="hasAnchor">
<a href="#meteorology" class="anchor"></a>Meteorology</h3>
<p>Water balance simulations of function <code><a href="../../reference/spwb.html">spwb()</a></code> require <strong>daily weather</strong> inputs. The weather variables that are required depend on the complexity of the soil water balance model we are using. In the simplest case, only <strong>mean temperature</strong>, <strong>precipitation</strong> and <strong>potential evapo-transpiration (PET)</strong> is required, but the more complex simulation model also requires radiation, wind speed, min/max temparature and relative humitidy. Here we already have a data frame with the daily meteorology measured at Font-Blanche for year 2014:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb_meteo</span> <span class="op">=</span> <span class="va">fb</span><span class="op">$</span><span class="va">meteoData</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">fb_meteo</span><span class="op">)</span></code></pre></div>
<pre><code>##            DOY MeanTemperature MinTemperature MaxTemperature
## 2014-01-01   1        7.661856       5.988889       8.960000
## 2014-01-02   2        9.525431       7.958333      11.550000
## 2014-01-03   3        9.482417       8.176111      11.762220
## 2014-01-04   4       10.016813       6.313000      11.010000
## 2014-01-05   5        6.619919       4.766000       9.060555
## 2014-01-06   6        8.923008       6.793889      12.329440
##            MeanRelativeHumidity MinRelativeHumidity MaxRelativeHumidity
## 2014-01-01             87.78224            80.37265            98.48404
## 2014-01-02             96.40669            84.22588           107.19601
## 2014-01-03             93.05705            79.93501           101.65442
## 2014-01-04             96.31667            90.14023           123.91053
## 2014-01-05             57.77938            48.92043            65.71329
## 2014-01-06             64.40477            51.31975            74.46718
##            WindSpeed Precipitation Radiation       PET
## 2014-01-01  2.317495      0.000000 1.5050178 0.7069255
## 2014-01-02  2.407691      0.000000 2.6173102 0.6178613
## 2014-01-03  1.950114      0.000000 3.9089762 0.7069555
## 2014-01-04  3.596797      2.590674 0.4753025 0.3102462
## 2014-01-05  7.310334      0.000000 8.6224570 2.6767326
## 2014-01-06  2.301697      0.000000 6.7835715 1.3093853</code></pre>
<p>Simulation models in <code>medfate</code> have been designed to work along with data generated from package <code>meteoland</code> (De Caceres et al. 2018), which specifies conventions for variable names and units. The user is strongly recommended to resort to this package to obtain suitable weather input for soil water balance simulations (see <a href="http://emf-creaf.github.io/meteoland" class="uri">http://emf-creaf.github.io/meteoland</a>).</p>
</div>
<div id="simulation-control" class="section level3">
<h3 class="hasAnchor">
<a href="#simulation-control" class="anchor"></a>Simulation control</h3>
<p>Apart from data inputs, the behavior of simulation models can be controlled using a set of <strong>global parameters</strong>. The default global parameter values are obtained using function <code><a href="../../reference/defaultControl.html">defaultControl()</a></code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb_control</span> <span class="op">=</span> <span class="fu"><a href="../../reference/defaultControl.html">defaultControl</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">fb_control</span><span class="op">$</span><span class="va">transpirationMode</span> <span class="op">=</span> <span class="st">"Sperry"</span>
<span class="va">fb_control</span><span class="op">$</span><span class="va">cochard</span> <span class="op">=</span> <span class="cn">T</span>
<span class="va">fb_control</span><span class="op">$</span><span class="va">capacitance</span> <span class="op">=</span> <span class="cn">T</span>
<span class="va">fb_control</span><span class="op">$</span><span class="va">subdailyResults</span> <span class="op">=</span> <span class="cn">T</span></code></pre></div>
<p>Most of these parameters should normally be left to their default value. However, there are three that deserve some explanation here:</p>
<ol style="list-style-type: decimal">
<li>Console output can be turned off by setting <code>verbose = FALSE</code>.</li>
<li>The soil water retention curves can be switched between Saxton’s and Van Genuchten’s using parameter <code>soilFunctions</code>.</li>
<li>The complexity of the soil water balance calculations will be very different if we set <code>transpirationMode = "Sperry"</code>. Most of the other options apply in the case of complex soil water balance only.</li>
</ol>
</div>
<div id="water-balance-input-object" class="section level3">
<h3 class="hasAnchor">
<a href="#water-balance-input-object" class="anchor"></a>Water balance input object</h3>
<p>A last step is needed before calling simulation functions. It consists in the compilation of all aboveground and belowground parameters and the specification of additional parameter values for each plant cohort, such as their light extinction coefficient or their response to drought. If one has a <code>forest</code> object, the <code>spwbInput</code> object can be generated in directly from it, avoiding the need to explicitly build <code>fb_above</code> and <code>fb_below</code> data frames:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb_x</span> <span class="op">=</span> <span class="fu"><a href="../../reference/modelInput.html">forest2spwbInput</a></span><span class="op">(</span><span class="va">fb_forest</span>, <span class="va">fb_soil</span>, <span class="va">SpParamsFB</span>, <span class="va">fb_control</span><span class="op">)</span></code></pre></div>
<p>Different species parameter variables will be drawn from <code>SpParamsMED</code> depending on the value of <code>transpirationMode</code>. For the simple water balance model, relatively few parameters are needed. All the input information for forest data and species parameter values can be inspected by printing the input object.</p>
<p>It is important to remember that, unlike normal objects in R, any water balance simulation will modify the <code>spwbInput</code> object. Hence, one can use the same object to simulate water balance sequentially and the final state of one simulation is the initial state of the next.</p>
<p>Finally, note that one can play with plant-specific parameters for soil water balance (instead of using species-level values) by using function <code><a href="../../reference/modifyParams.html">modifyCohortParams()</a></code>:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/modifyParams.html">modifyCohortParams</a></span><span class="op">(</span><span class="va">fb_x</span>, <span class="va">fb</span><span class="op">$</span><span class="va">customParams</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>We recommend using <code><a href="../../reference/modifyParams.html">modifyCohortParams()</a></code> instead of manually modifying values in the <code>spwbInput</code> object because some parameters are related, so that modifying a given parameter value should affect others. These dependencies are taken into account automatically in <code><a href="../../reference/modifyParams.html">modifyCohortParams()</a></code>.</p>
</div>
</div>
<div id="soil-water-balance" class="section level2">
<h2 class="hasAnchor">
<a href="#soil-water-balance" class="anchor"></a>Soil water balance</h2>
<div id="running-the-model" class="section level3">
<h3 class="hasAnchor">
<a href="#running-the-model" class="anchor"></a>Running the model</h3>
<p>Function <code><a href="../../reference/spwb.html">spwb()</a></code> requires three main objects as input:</p>
<ul>
<li>A <code>spwbInput</code> object with forest parameters (<code>fb_x</code> in our case).</li>
<li>A <code>soil</code> object with soil parameters (<code>fb_soil</code> in our case).</li>
<li>A data frame with daily meteorology for the study period (<code>fb_meteo</code> in our case).</li>
</ul>
<p>Now we are ready to call function <code><a href="../../reference/spwb.html">spwb()</a></code>:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb_SWB</span> <span class="op">=</span> <span class="fu"><a href="../../reference/spwb.html">spwb</a></span><span class="op">(</span><span class="va">fb_x</span>, <span class="va">fb_meteo</span>, elevation <span class="op">=</span> <span class="fl">420</span>, latitude <span class="op">=</span> <span class="fl">43.24083</span><span class="op">)</span></code></pre></div>
<pre><code>## Initial soil water content (mm): 268.656
## Initial snowpack content (mm): 0
## Performing daily simulations 
##  Year 2014:........</code></pre>
<pre><code>## Warning in spwb(fb_x, fb_meteo, elevation = 420, latitude = 43.24083): overflow
## problem in the computation of one of the gamma factors before starting the
## Newton iteration. The initial approximation to the root is given as output.</code></pre>
<pre><code>## ......</code></pre>
<pre><code>## Warning in spwb(fb_x, fb_meteo, elevation = 420, latitude = 43.24083): overflow
## problem in the computation of one of the gamma factors before starting the
## Newton iteration. The initial approximation to the root is given as output.</code></pre>
<pre><code>## ......................done.
## Final soil water content (mm): 265.612
## Final snowpack content (mm): 0
## Change in soil water content (mm): -3.04425
## Soil water balance result (mm): -3.04425
## Change in snowpack water content (mm): 0
## Snowpack water balance result (mm): 0
## Water balance components:
##   Precipitation (mm) 1066
##   Rain (mm) 1066 Snow (mm) 0
##   Interception (mm) 214 Net rainfall (mm) 851
##   Infiltration (mm) 674 Runoff (mm) 178 Deep drainage (mm) 283
##   Soil evaporation (mm) 21 Transpiration (mm) 372
##   Plant extraction from soil (mm) 372  Plant water balance (mm) 0 Hydraulic redistribution (mm) 65</code></pre>
<p>Console output provides the water balance totals for the period considered, which may span several years. The output of function <code><a href="../../reference/spwb.html">spwb()</a></code> is an object of class with the same name, actually a list:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "spwb" "list"</code></pre>
<p>If we inspect its elements, we realize that there are several components:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html">names</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "latitude"          "topography"        "spwbInput"        
##  [4] "WaterBalance"      "EnergyBalance"     "Temperature"      
##  [7] "TemperatureLayers" "Soil"              "Stand"            
## [10] "Plants"            "SunlitLeaves"      "ShadeLeaves"      
## [13] "subdaily"</code></pre>
<p>In particular, element <code>spwbInput</code> contains a copy of the input parameters that were used to run the model. <code>WaterBalance</code> contains water balance components in form of a data frame with days in rows:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">$</span><span class="va">WaterBalance</span><span class="op">)</span></code></pre></div>
<pre><code>##                  PET Precipitation     Rain Snow   NetRain Snowmelt
## 2014-01-01 0.7069121      0.000000 0.000000    0 0.0000000        0
## 2014-01-02 0.6178379      0.000000 0.000000    0 0.0000000        0
## 2014-01-03 0.7069201      0.000000 0.000000    0 0.0000000        0
## 2014-01-04 0.3102423      2.590674 2.590674    0 0.3003475        0
## 2014-01-05 2.6766516      0.000000 0.000000    0 0.0000000        0
## 2014-01-06 1.3093186      0.000000 0.000000    0 0.0000000        0
##            Infiltration Runoff DeepDrainage Evapotranspiration Interception
## 2014-01-01    0.0000000      0   0.00000000          0.1497369     0.000000
## 2014-01-02    0.0000000      0   0.00000000          0.1252269     0.000000
## 2014-01-03    0.0000000      0   0.00000000          0.1455306     0.000000
## 2014-01-04    0.3003475      0   0.02565232          2.3532077     2.290326
## 2014-01-05    0.0000000      0   0.01719684          0.9804955     0.000000
## 2014-01-06    0.0000000      0   0.00000000          0.8183594     0.000000
##            SoilEvaporation PlantExtraction Transpiration
## 2014-01-01       0.1432810    5.476247e-03   0.006455883
## 2014-01-02       0.1252269    4.006127e-17   0.000000000
## 2014-01-03       0.1432826    2.023199e-03   0.002247962
## 2014-01-04       0.0628817   -1.079323e-16   0.000000000
## 2014-01-05       0.3045388    6.654738e-01   0.675956714
## 2014-01-06       0.1513321    6.645196e-01   0.667027240
##            HydraulicRedistribution
## 2014-01-01            0.0008087009
## 2014-01-02            0.0023850937
## 2014-01-03            0.0031871370
## 2014-01-04            0.0022031559
## 2014-01-05            0.0000000000
## 2014-01-06            0.0000000000</code></pre>
<p>Elements <code>PlantLAI</code>, <code>PlantStress</code>, <code>PlantPsi</code>, <code>PlantTranspiration</code> and <code>PlantPhotosynthesis</code> contain daily values by plant cohorts, for example plant stress values are:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">$</span><span class="va">Plant</span><span class="op">$</span><span class="va">PlantStress</span><span class="op">)</span></code></pre></div>
<pre><code>##                T1_142     T2_148     T3_168
## 2014-01-01 0.03815949 0.03877847 0.03818111
## 2014-01-02 0.09262452 0.09280681 0.09263836
## 2014-01-03 0.07843611 0.07866182 0.07846144
## 2014-01-04 0.05038956 0.05059668 0.05041364
## 2014-01-05 0.02884745 0.02282267 0.01954262
## 2014-01-06 0.09178632 0.08667452 0.08380800</code></pre>
<p>In the following two subsections we learn how to inspect model output.</p>
</div>
<div id="comparing-results-with-observations" class="section level3">
<h3 class="hasAnchor">
<a href="#comparing-results-with-observations" class="anchor"></a>Comparing results with observations</h3>
<p>Evapotranspiration and soil moisture content (0-30 cm layer) was measured at Font-Blanche during the study period of 2014 and this allows comparing the simulation results with observations. We first load the measured data into the workspace and filter for the dates used in the simulation:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb_observed</span> <span class="op">=</span> <span class="va">fb</span><span class="op">$</span><span class="va">measuredData</span>
<span class="va">fb_observed</span> <span class="op">=</span> <span class="va">fb_observed</span><span class="op">[</span><span class="va">fb_observed</span><span class="op">$</span><span class="va">Date</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">fb_meteo</span><span class="op">)</span>,<span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">fb_observed</span><span class="op">)</span></code></pre></div>
<pre><code>##                  Date       SWC SWC.err       ETR E_T2_148 E_T2_148_err
## 2014-01-01 2014-01-01 0.5813407      NA 0.2259528       NA           NA
## 2014-01-02 2014-01-02 0.6507478      NA 0.2337668       NA           NA
## 2014-01-03 2014-01-03 0.6224243      NA 0.5229000       NA           NA
## 2014-01-04 2014-01-04        NA      NA 0.1117191       NA           NA
## 2014-01-05 2014-01-05 0.6285134      NA 0.8132403       NA           NA
## 2014-01-06 2014-01-06 0.6035415      NA 0.6012234       NA           NA
##            E_T3_168 E_T3_168_err PD_T2_148 PD_T2_148_err PD_T3_168
## 2014-01-01       NA           NA        NA            NA        NA
## 2014-01-02       NA           NA        NA            NA        NA
## 2014-01-03       NA           NA        NA            NA        NA
## 2014-01-04       NA           NA        NA            NA        NA
## 2014-01-05       NA           NA        NA            NA        NA
## 2014-01-06       NA           NA        NA            NA        NA
##            PD_T3_168_err MD_T2_148 MD_T2_148_err MD_T3_168 MD_T3_168_err
## 2014-01-01            NA        NA            NA        NA            NA
## 2014-01-02            NA        NA            NA        NA            NA
## 2014-01-03            NA        NA            NA        NA            NA
## 2014-01-04            NA        NA            NA        NA            NA
## 2014-01-05            NA        NA            NA        NA            NA
## 2014-01-06            NA        NA            NA        NA            NA</code></pre>
<p>We can now compare the observed vs modelled evapotranspiration. For this comparison we do not include intercepted water, so we compare measured evapo transpiration with modelled transpiration plus soil evaporation:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb_ET</span> <span class="op">=</span> <span class="va">fb_SWB</span><span class="op">$</span><span class="va">WaterBalance</span><span class="op">$</span><span class="va">SoilEvaporation</span> <span class="op">+</span> <span class="va">fb_SWB</span><span class="op">$</span><span class="va">WaterBalance</span><span class="op">$</span><span class="va">Transpiration</span></code></pre></div>
<p>The relationship can be shown in a scatter plot:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_ET</span>, <span class="va">fb_observed</span><span class="op">$</span><span class="va">ETR</span>, xlab<span class="op">=</span><span class="st">"modelled ETR (mm)"</span>, ylab<span class="op">=</span><span class="st">"measured ETR (mm)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>, b<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-28-1.png" width="480" style="display: block; margin: auto;"> Where we see a reasonably good relationship, but the model tends to underestimate total transpiration. We know that interception is missing from modelled ETR, but we cannot discard other sources of error. Instead of using a scatter plot, we can display the dynamics of the two series together:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fb_meteo</span><span class="op">)</span><span class="op">)</span>, <span class="va">fb_ET</span>, type<span class="op">=</span><span class="st">"l"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>,
     xlab <span class="op">=</span> <span class="st">""</span>, ylab<span class="op">=</span><span class="st">"ETR (mm)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">fb_observed</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span>, <span class="va">fb_observed</span><span class="op">$</span><span class="va">ETR</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"modelled"</span>, <span class="st">"observed"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"red"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">1</span>, bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-29-1.png" width="480" style="display: block; margin: auto;"></p>
<p>To compare observed vs modelled soil moisture dynamics we need to scale moisture content from <code>W</code> (the proportion of moisture with respect to field capacity):</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fb_W1</span> <span class="op">=</span> <span class="va">fb_SWB</span><span class="op">$</span><span class="va">Soil</span><span class="op">$</span><span class="va">W.1</span> <span class="op">*</span> <span class="fu"><a href="../../reference/soil%20texture%20and%20hydraulics.html">soil_thetaFC</a></span><span class="op">(</span><span class="va">fb_soil</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></code></pre></div>
<p>Like with evapotranspiration, the relationship can be shown in a scatter plot:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_W1</span>, <span class="va">fb_observed</span><span class="op">$</span><span class="va">SWC</span>, xlab<span class="op">=</span><span class="st">" modelled SMC"</span>, ylab<span class="op">=</span><span class="st">"measured SMC"</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-31-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Surprisingly, the scales of the modelled and measured SMC do not match. We can also compare the soil moisture dynamics of the two series:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fb_meteo</span><span class="op">)</span><span class="op">)</span>, <span class="va">fb_W1</span>, type<span class="op">=</span><span class="st">"l"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.8</span><span class="op">)</span>,
     xlab <span class="op">=</span> <span class="st">""</span>, ylab<span class="op">=</span><span class="st">"SMC"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">fb_observed</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span>, <span class="va">fb_observed</span><span class="op">$</span><span class="va">SWC</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"top"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"modelled"</span>, <span class="st">"observed"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"red"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">1</span>, bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-32-1.png" width="480" style="display: block; margin: auto;"> Again, it is obvious the two series do not have the same maximum and minimum values. This occurs for several reasons (calibration of moisture sensors, different assumed textures, …), but can be overcome if we standardize the two series:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">fb_meteo</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">fb_W1</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"l"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,
     xlab <span class="op">=</span><span class="st">""</span>, ylab<span class="op">=</span><span class="st">"Scaled SMC"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">fb_observed</span><span class="op">$</span><span class="va">Date</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">fb_observed</span><span class="op">$</span><span class="va">SWC</span><span class="op">)</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span><span class="st">"top"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"modelled"</span>, <span class="st">"observed"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"red"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">1</span>, bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-33-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="drawing-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#drawing-plots" class="anchor"></a>Drawing plots</h2>
<p>Package <code>medfate</code> provides a simple <code>plot</code> function for objects of class <code>spwb</code>. Here we will use this function to display the seasonal variation predicted by the model, as well as the variation at higher temporal resolution within different selected 3-day periods that we define here:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-03-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-03-03"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span>
<span class="va">d2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-06-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-06-03"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span>
<span class="va">d3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-08-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-08-03"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span>
<span class="va">d4</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-10-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-10-03"</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span></code></pre></div>
<div id="meteorological-input-and-inputoutput-water-flows" class="section level3">
<h3 class="hasAnchor">
<a href="#meteorological-input-and-inputoutput-water-flows" class="anchor"></a>Meteorological input and input/output water flows</h3>
<p>Function <code><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot()</a></code> can be used to show the meteorological input:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, type <span class="op">=</span> <span class="st">"PET_Precipitation"</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-35-1.png" width="768"> It is apparent the climatic drought period between april and august 2014. This should have an impact on soil moisture and plant stress.</p>
<p>If we are interested in forest hydrology, we can plot the amount of water that the model predicts to leave the forest via surface runoff or drainage to lower water compartments.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, type <span class="op">=</span> <span class="st">"Export"</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-36-1.png" width="768"> As expected, water exported from the forest plot was only relevant for the autumn and winter periods. Note also that the model predicts some runoff during convective storms during autumn, whereas winter events occur when the soil is already full, so that most exported water is assumed to be lost via deep drainage. One can also display the evapotranspiration flows, which we do in the following plot that also combines the two previous:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>
<span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"Evapotranspiration"</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.13</span>,<span class="fl">0.73</span><span class="op">)</span><span class="op">)</span>
<span class="va">g3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"Export"</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.35</span>,<span class="fl">0.60</span><span class="op">)</span><span class="op">)</span>
<span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>,<span class="va">g2</span>, <span class="va">g3</span>, ncol<span class="op">=</span><span class="fl">1</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">1</span>,<span class="fl">0.6</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-37-1.png" width="768"></p>
</div>
<div id="soil-moisture-dynamics-and-hydraulic-redistribution" class="section level3">
<h3 class="hasAnchor">
<a href="#soil-moisture-dynamics-and-hydraulic-redistribution" class="anchor"></a>Soil moisture dynamics and hydraulic redistribution</h3>
<p>It is also useful to plot the dynamics of soil state variables by layer, such as the percentage of moisture in relation to field capacity (i.e. variable <code>W</code>):</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, type<span class="op">=</span><span class="st">"SoilTheta"</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-38-1.png" width="768"> Note that the model predicts soil drought to occur earlier in the season for the first two layers (0-100 cm) whereas the other two layers dry much more slowly. At this point is important to mention that the water balance model we used does not incorporate hydraulic redistribution. We can also display the dynamics of the corresponding soil layer water potentials:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, type<span class="op">=</span><span class="st">"SoilPsi"</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-39-1.png" width="768"> or draw a composite plot including absolute soil water volume:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>
<span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"SoilVol"</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.08</span>,<span class="fl">0.65</span><span class="op">)</span><span class="op">)</span>
<span class="va">g3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"SoilPsi"</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.08</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>,  <span class="va">g3</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-40-1.png" width="768"></p>
</div>
<div id="root-water-uptake-and-hydraulic-redistribution" class="section level3">
<h3 class="hasAnchor">
<a href="#root-water-uptake-and-hydraulic-redistribution" class="anchor"></a>Root water uptake and hydraulic redistribution</h3>
<p>The following composite plot shows the daily root water uptake (or release) from different soil layers, and the daily amount of water entering soil layers due to hydraulic redistribution:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"SoilPsi"</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">"Soil wp (MPa)"</span><span class="op">)</span>
<span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"PlantExtraction"</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.08</span>,<span class="fl">0.68</span><span class="op">)</span><span class="op">)</span>
<span class="va">g3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"HydraulicRedistribution"</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.08</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>,  <span class="va">g3</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-41-1.png" width="768"></p>
<p>If we create a composite plot including subdaily water uptake/release patterns, we can further understand the redistribution flows created by the model during different periods:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">g0</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"PlantExtraction"</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.08</span>,<span class="fl">0.68</span><span class="op">)</span><span class="op">)</span>
<span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"PlantExtraction"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d1</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>,<span class="fl">0.13</span><span class="op">)</span><span class="op">)</span>
<span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"PlantExtraction"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d2</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>,<span class="fl">0.13</span><span class="op">)</span><span class="op">)</span>
<span class="va">g3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"PlantExtraction"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d3</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>,<span class="fl">0.13</span><span class="op">)</span><span class="op">)</span>
<span class="va">g4</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"PlantExtraction"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d4</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>,<span class="fl">0.13</span><span class="op">)</span><span class="op">)</span>
<span class="fu">plot_grid</span><span class="op">(</span><span class="va">g0</span>,<span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>, <span class="va">g3</span>, <span class="va">g4</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-42-1.png" width="768"></p>
</div>
<div id="plant-transpiration" class="section level3">
<h3 class="hasAnchor">
<a href="#plant-transpiration" class="anchor"></a>Plant transpiration</h3>
<p>We can use function <code><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot()</a></code> to display the seasonal dynamics of cohort-level variables, such as plant transpiration per leaf area:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, type<span class="op">=</span><span class="st">"TranspirationPerLeaf"</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-43-1.png" width="768"> Where we can observe that some species transpire more than others due to their vertical position within the canopy.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>
<span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"TranspirationPerLeaf"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.75</span><span class="op">)</span><span class="op">)</span>
<span class="va">g21</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafTranspiration"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d1</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.32</span><span class="op">)</span><span class="op">)</span>
<span class="va">g22</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafTranspiration"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d2</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.32</span><span class="op">)</span><span class="op">)</span>
<span class="va">g23</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafTranspiration"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d3</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.32</span><span class="op">)</span><span class="op">)</span>
<span class="va">g24</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafTranspiration"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d4</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.32</span><span class="op">)</span><span class="op">)</span>
<span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>,  
          <span class="fu">plot_grid</span><span class="op">(</span><span class="va">g21</span>,<span class="va">g22</span>,<span class="va">g23</span>,<span class="va">g24</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, 
          ncol<span class="op">=</span><span class="fl">1</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 18 row(s) containing missing values (geom_path).</code></pre>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-44-1.png" width="768"></p>
</div>
<div id="plant-stress" class="section level3">
<h3 class="hasAnchor">
<a href="#plant-stress" class="anchor"></a>Plant stress</h3>
<p>In the model, reduction of (whole-plant) plant transpiration is what used to define drought stress, which depends on the species identity:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, type<span class="op">=</span><span class="st">"PlantStress"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-45-1.png" width="768"></p>
<p>To examine the impact of drought on plants, one can inspect the whole-plant conductance (from which the stress index is derived) or the stem percent loss of conductance derived from embolism, as we do in the following composite plot:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>
<span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"SoilPlantConductance"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">ylab</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Soil-plant conductance "</span>,<span class="op">(</span><span class="va">mmol</span><span class="op">%.%</span><span class="va">m</span><span class="op">^</span><span class="op">{</span><span class="op">-</span><span class="fl">2</span><span class="op">}</span><span class="op">%.%</span><span class="va">s</span><span class="op">^</span><span class="op">{</span><span class="op">-</span><span class="fl">1</span><span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>
<span class="va">g3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"StemPLC"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.75</span><span class="op">)</span><span class="op">)</span>
<span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>,<span class="va">g3</span>,                          
          ncol<span class="op">=</span><span class="fl">1</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-46-1.png" width="768"> ### Leaf water potentials</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>
<span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafPsiRange"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Leaf water potential (MPa)"</span><span class="op">)</span>
<span class="va">g21</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafPsi"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d1</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">g22</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafPsi"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d2</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">g23</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafPsi"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d3</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">g24</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafPsi"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d4</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>,                          
          <span class="fu">plot_grid</span><span class="op">(</span><span class="va">g21</span>,<span class="va">g22</span>,<span class="va">g23</span>,<span class="va">g24</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, 
          ncol<span class="op">=</span><span class="fl">1</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-47-1.png" width="768"></p>
</div>
<div id="stomatal-conductance" class="section level3">
<h3 class="hasAnchor">
<a href="#stomatal-conductance" class="anchor"></a>Stomatal conductance</h3>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">g1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>
<span class="va">g2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"GSWMax_SL"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_date</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 month"</span>, date_labels <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.74</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">"Sunlit leaf stomatal conductance"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.3</span><span class="op">)</span><span class="op">)</span>
<span class="va">g21</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafStomatalConductance"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d1</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>
<span class="va">g22</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafStomatalConductance"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d2</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>
<span class="va">g23</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafStomatalConductance"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d3</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>
<span class="va">g24</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/sensitivity/man/plot.support.html">plot</a></span><span class="op">(</span><span class="va">fb_SWB</span>, <span class="st">"LeafStomatalConductance"</span>, subdaily <span class="op">=</span> <span class="cn">T</span>, dates <span class="op">=</span> <span class="va">d4</span><span class="op">)</span><span class="op">+</span><span class="fu">scale_x_datetime</span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">"1 day"</span>,  date_labels <span class="op">=</span> <span class="st">"%m/%d"</span><span class="op">)</span><span class="op">+</span><span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span><span class="fu">ylab</span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>
<span class="fu">plot_grid</span><span class="op">(</span><span class="va">g1</span>, <span class="va">g2</span>,
          <span class="fu">plot_grid</span><span class="op">(</span><span class="va">g21</span>,<span class="va">g22</span>,<span class="va">g23</span>,<span class="va">g24</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span>,
          ncol<span class="op">=</span><span class="fl">1</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.4</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 18 row(s) containing missing values (geom_path).</code></pre>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-48-1.png" width="768"></p>
</div>
</div>
<div id="generating-output-summaries" class="section level2">
<h2 class="hasAnchor">
<a href="#generating-output-summaries" class="anchor"></a>Generating output summaries</h2>
<p>While the water balance model operates at daily and sub-daily steps, users will normally be interested in outputs at larger time scales. The package provides a <code>summary</code> for objects of class <code>spwb</code>. This function can be used to summarize the model’s output at different temporal steps (i.e. weekly, monthly or annual). For example, to obtain the average soil moisture and water potentials by months one can use:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fb_SWB</span>, freq<span class="op">=</span><span class="st">"months"</span>,FUN<span class="op">=</span><span class="va">sum</span>, output<span class="op">=</span><span class="st">"WaterBalance"</span><span class="op">)</span></code></pre></div>
<pre><code>##                  PET Precipitation      Rain Snow      NetRain Snowmelt
## 2014-01-01  33.86961     205.04814 205.04814    0 170.82436609        0
## 2014-02-01  47.77537     181.09641 181.09641    0 140.69992306        0
## 2014-03-01 104.36467      44.61248  44.61248    0  37.16330992        0
## 2014-04-01 139.43050      15.00000  15.00000    0   4.23166571        0
## 2014-05-01 187.72494      21.60000  21.60000    0  14.89516341        0
## 2014-06-01 211.53241      33.60000  33.60000    0  23.76353991        0
## 2014-07-01 231.97039       0.60000   0.60000    0   0.06956049        0
## 2014-08-01 202.65014      60.40000  60.40000    0  50.14691302        0
## 2014-09-01 132.22085     137.60000 137.60000    0 120.16973738        0
## 2014-10-01  82.90101      50.60000  50.60000    0  37.39533330        0
## 2014-11-01  38.23557     222.60000 222.60000    0 182.05487758        0
## 2014-12-01  34.14517      93.00000  93.00000    0  70.08407135        0
##            Infiltration     Runoff DeepDrainage Evapotranspiration Interception
## 2014-01-01 142.30760239 28.5167637   111.172965           46.70186   34.2237744
## 2014-02-01 106.33090717 34.3690159   107.487827           59.56929   40.3964853
## 2014-03-01  34.24217037  2.9211395     8.344230           53.76749    7.4491665
## 2014-04-01   4.23166571  0.0000000     0.000000           69.99234   10.7683343
## 2014-05-01  14.62171508  0.2734483     0.000000           71.51930    6.7048366
## 2014-06-01  22.93752859  0.8260113     0.000000           64.30484    9.8364601
## 2014-07-01   0.06956049  0.0000000     0.000000           14.90096    0.5304395
## 2014-08-01  33.56091563 16.5859974     0.000000           34.99745   10.2530870
## 2014-09-01  85.26626136 34.9034760     0.000000           46.43157   17.4302616
## 2014-10-01  29.95314538  7.4421879     0.000000           50.64072   13.2046667
## 2014-11-01 142.12132786 39.9335497     9.524732           56.97216   40.5451224
## 2014-12-01  58.14395507 11.9401163    46.942081           37.76281   22.9159287
##            SoilEvaporation PlantExtraction Transpiration
## 2014-01-01       4.0034686        8.465509      8.474616
## 2014-02-01       4.5302492       14.634553     14.642551
## 2014-03-01       2.5714114       43.723351     43.746914
## 2014-04-01       0.3676791       58.817338     58.856330
## 2014-05-01       0.1823983       64.494678     64.632066
## 2014-06-01       0.1460781       54.109147     54.322297
## 2014-07-01       0.1304756       12.833227     14.240046
## 2014-08-01       0.1534419       25.590098     24.590926
## 2014-09-01       0.3423831       29.400990     28.658924
## 2014-10-01       1.0867578       36.434579     36.349297
## 2014-11-01       3.9555725       12.545570     12.471463
## 2014-12-01       3.5333717       11.306845     11.313510
##            HydraulicRedistribution
## 2014-01-01             0.160446275
## 2014-02-01             0.060570648
## 2014-03-01             0.063427929
## 2014-04-01             0.538016591
## 2014-05-01             7.050191840
## 2014-06-01             7.000769296
## 2014-07-01             0.002002839
## 2014-08-01             9.403196239
## 2014-09-01            17.690232815
## 2014-10-01            16.090313677
## 2014-11-01             7.284316963
## 2014-12-01             0.058170617</code></pre>
<p>Parameter <code>output</code> is used to indicate the element of the <code>spwb</code> object for which we desire summaries. Similarly, it is possible to calculate the average stress of the three tree species by months:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fb_SWB</span>, freq<span class="op">=</span><span class="st">"months"</span>,FUN<span class="op">=</span><span class="va">mean</span>, output<span class="op">=</span><span class="st">"PlantStress"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>##            Phillyrea latifolia Pinus halepensis  Quercus ilex
## 2014-01-01          0.05520094       0.05289700  5.113632e-02
## 2014-02-01          0.04921513       0.04438112  4.112194e-02
## 2014-03-01          0.04462671       0.02844036  2.033375e-02
## 2014-04-01          0.04051453       0.01742824 -8.574255e-05
## 2014-05-01          0.12355917       0.09457951  1.234583e-02
## 2014-06-01          0.35846873       0.33692804  1.697636e-01
## 2014-07-01          0.81054080       0.82793981  7.713825e-01
## 2014-08-01          0.64452731       0.66020363  5.609444e-01
## 2014-09-01          0.46463133       0.47600282  4.011069e-01
## 2014-10-01          0.06000986       0.05421688  2.748961e-02
## 2014-11-01          0.05114231       0.04996165  4.277569e-02
## 2014-12-01          0.04041427       0.03767856  3.539778e-02</code></pre>
<p>In this case, the <code>summary</code> function aggregates the output by species using LAI values as weights. However, another function called <code><a href="../../reference/spwb_stress.html">spwb_stress()</a></code> allows calculating other drought indices, for example the <strong>number of days with drought stress</strong>:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../../reference/spwb_stress.html">spwb_stress</a></span><span class="op">(</span><span class="va">fb_SWB</span>, freq<span class="op">=</span><span class="st">"months"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="FontBlanche_files/figure-html/unnamed-chunk-51-1.png" width="700"> Where we see that Aleppo pine has a longer season of drought stress, marked by its closure of stomata.</p>
</div>
<div id="bibliography" class="section level2">
<h2 class="hasAnchor">
<a href="#bibliography" class="anchor"></a>Bibliography</h2>
<ul>
<li><p>De Caceres M, Martin-StPaul N, Turco M, et al (2018) Estimating daily meteorological data and downscaling climate models over landscapes. Environ Model Softw 108:186–196. doi: 10.1016/j.envsoft.2018.08.003</p></li>
<li><p>De Caceres M, Martinez-Vilalta J, Coll L, et al (2015) Coupling a water balance model with forest inventory data to predict drought stress: the role of forest structural changes vs. climate changes. Agric For Meteorol 213:77–90. doi: 10.1016/j.agrformet.2015.06.012</p></li>
<li><p>Simioni G, Durand-gillmann M, Huc R, et al (2013) Asymmetric competition increases leaf inclination effect on light absorption in mixed canopies. Ann For Sci 70:123–131. doi: 10.1007/s13595-012-0246-8</p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Miquel De Cáceres, Shengli Huang, Víctor Granda, Antoine Cabon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
