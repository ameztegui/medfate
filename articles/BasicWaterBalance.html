<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basic water balance • medfate</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Basic water balance">
<meta property="og:description" content="medfate">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">medfate</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/emf-creaf/medfate/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="BasicWaterBalance_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Basic water balance</h1>
                        <h4 class="author">Miquel De Caceres</h4>
            
            <h4 class="date">2021-07-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/medfate/blob/master/vignettes/BasicWaterBalance.Rmd"><code>vignettes/BasicWaterBalance.Rmd</code></a></small>
      <div class="hidden name"><code>BasicWaterBalance.Rmd</code></div>

    </div>

    
    
<div id="about-this-vignette" class="section level2">
<h2 class="hasAnchor">
<a href="#about-this-vignette" class="anchor"></a>About this vignette</h2>
<p>The present document describes how to run the soil plant water balance model described in De Cáceres et al. (2015) using package <code>medfate</code>. The document illustrates how to prepare the inputs, use the simulation functions and inspect the outputs. All the details of the model design and formulation can be found at <a href="https://emf-creaf.github.io/medfatebook/index.html" class="uri">https://emf-creaf.github.io/medfatebook/index.html</a>. Because it introduces many basic features of simulations with package <code>medfate</code>, this document should be read before addressing advanced topics of water balance simulations or growth simulations.</p>
</div>
<div id="preparing-model-inputs" class="section level2">
<h2 class="hasAnchor">
<a href="#preparing-model-inputs" class="anchor"></a>Preparing model inputs</h2>
<p>Model inputs are explained in greater detail in vignette ‘<em>Simulation inputs</em>’. Here we only review the different steps required to run function <code><a href="../reference/spwb.html">spwb()</a></code>.</p>
<div id="soil-vegetation-meteorology-and-species-data" class="section level3">
<h3 class="hasAnchor">
<a href="#soil-vegetation-meteorology-and-species-data" class="anchor"></a>Soil, vegetation, meteorology and species data</h3>
<p>Soil information needs to be entered as a <code>data frame</code> with soil layers in rows and physical attributes in columns. Soil physical attributes can be initialized to default values, for a given number of layers, using function <code><a href="../reference/defaultSoilParams.html">defaultSoilParams()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spar</span> <span class="op">=</span> <span class="fu"><a href="../reference/defaultSoilParams.html">defaultSoilParams</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>The soil input for water balance simulation is actually a list of class <code>soil</code> that is created using a function with the same name:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">examplesoil</span> <span class="op">=</span> <span class="fu"><a href="../reference/soil.html">soil</a></span><span class="op">(</span><span class="va">spar</span><span class="op">)</span></code></pre></div>
<p>As explained in the package overview, models included in <code>medfate</code> were primarily designed to be ran on <strong>forest inventory plots</strong>. Here we use the example object provided with the package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">exampleforestMED</span><span class="op">)</span>
<span class="va">exampleforestMED</span></code></pre></div>
<pre><code>## $ID
## [1] "1"
## 
## $patchsize
## [1] 10000
## 
## $treeData
##   Species   N   DBH Height Z50  Z95
## 1     157 168 37.55    800 750 3000
## 2     176 384 14.60    660 750 3000
## 
## $shrubData
##   Species Cover Height Z50  Z95
## 1     174  3.75     80 300 1500
## 
## $herbCover
## [1] 10
## 
## $herbHeight
## [1] 20
## 
## attr(,"class")
## [1] "forest" "list"</code></pre>
<p>In the basic water balance, only mean temperature, precipitation and potential evapotranspiration is required, but radiation may also be necessary to simulate snow melt.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">examplemeteo</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">examplemeteo</span><span class="op">)</span></code></pre></div>
<pre><code>##            MeanTemperature MinTemperature MaxTemperature Precipitation
## 2001-01-01      3.57668969     -0.5934215       6.287950      4.869109
## 2001-01-02      1.83695972     -2.3662458       4.569737      2.498292
## 2001-01-03      0.09462563     -3.8541036       2.661951      0.000000
## 2001-01-04      1.13866156     -1.8744860       3.097705      5.796973
## 2001-01-05      4.70578690      0.3288287       7.551532      1.884401
## 2001-01-06      4.57036721      0.5461322       7.186784     13.359801
##            MeanRelativeHumidity MinRelativeHumidity MaxRelativeHumidity
## 2001-01-01             78.73709            65.15411           100.00000
## 2001-01-02             69.70800            57.43761            94.71780
## 2001-01-03             70.69610            58.77432            94.66823
## 2001-01-04             76.89156            66.84256            95.80950
## 2001-01-05             76.67424            62.97656           100.00000
## 2001-01-06             89.01940            74.25754           100.00000
##            Radiation WindSpeed WindDirection       PET
## 2001-01-01  12.89251  2.000000           172 1.3212770
## 2001-01-02  13.03079  7.662544           278 2.2185985
## 2001-01-03  16.90722  2.000000           141 1.8045176
## 2001-01-04  11.07275  2.000000           172 0.9200627
## 2001-01-05  13.45205  7.581347           321 2.2914449
## 2001-01-06  12.84841  6.570501           141 1.7255058</code></pre>
<p>Finally, simulations in <code>medfate</code> require a data frame with species parameter values, which we load using defaults for Catalonia (NE Spain):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"SpParamsMED"</span><span class="op">)</span></code></pre></div>
</div>
<div id="simulation-control" class="section level3">
<h3 class="hasAnchor">
<a href="#simulation-control" class="anchor"></a>Simulation control</h3>
<p>Apart from data inputs, the behaviour of simulation models can be controlled using a set of global parameters. The default parameterization is obtained using function <code><a href="../reference/defaultControl.html">defaultControl()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">control</span> <span class="op">=</span> <span class="fu"><a href="../reference/defaultControl.html">defaultControl</a></span><span class="op">(</span><span class="st">"Granier"</span><span class="op">)</span></code></pre></div>
<p>Some parameters deserve explanation here:</p>
<ol style="list-style-type: decimal">
<li>Console output can be turned off by setting <code>verbose = FALSE</code>.</li>
<li>The soil water retention curves can be switched between Saxton’s and Van Genuchten’s using parameter <code>soilFunctions</code>.</li>
<li>The complexity of the soil water balance calculations will be very different if we set <code>transpirationMode = "Sperry"</code>. Most of the other options apply in the case of advanced soil water balance only.</li>
</ol>
</div>
<div id="water-balance-input-object" class="section level3">
<h3 class="hasAnchor">
<a href="#water-balance-input-object" class="anchor"></a>Water balance input object</h3>
<p>A last object is needed before calling simulation functions, called <code>spwbInput</code>. It consists in the compilation of aboveground and belowground parameters and the specification of additional parameter values for each plant cohort. This is done by calling function <code><a href="../reference/modelInput.html">spwbInput()</a></code>, but if one has a <code>forest</code> object, the object can be generated more directly using function <code><a href="../reference/modelInput.html">forest2spwbInput()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="../reference/modelInput.html">forest2spwbInput</a></span><span class="op">(</span><span class="va">exampleforestMED</span>, <span class="va">examplesoil</span>, <span class="va">SpParamsMED</span>, <span class="va">control</span><span class="op">)</span></code></pre></div>
<p>Different parameter variables will be drawn depending on the value of <code>transpirationMode</code>. For the simple water balance model (<code>transpirationMode = "Granier"</code>), relatively few parameters are needed. All the input information for forest data and species parameter values can be inspected by accessing the different elements of this object, whose names are.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "control"             "soil"                "canopy"             
##  [4] "cohorts"             "above"               "below"              
##  [7] "belowLayers"         "paramsPhenology"     "paramsInterception" 
## [10] "paramsTranspiration" "internalPhenology"   "internalWater"</code></pre>
<p>Note that (since <strong>ver 2.0</strong>) the water balance input object contains an element <code>soil</code> with the soil input.</p>
<p>It is important to remember that, unlike normal objects in R, any water balance simulation will modify the <code>spwbInput</code> object. For example, the state of the soil at the end of the simulated process (i.e. <code>W</code>) will be stored. Hence, one can use the same object to simulate water balance sequentially and the final state of one simulation is the initial state of the next. In the case of soil water balance, these modifications are small, for example concerning <code>LAI_expanded</code>, but in the case of growth simulations the object is used to store the status of vegetation during and at the end of simulations.</p>
<p>Finally, note that users can set cohort-specific parameters for soil water balance (instead of using species-level values) by modifying manually the parameter values in this object. Since some parameters may be coordinated by design, however, it is better to use specific package functions for this purpose.</p>
</div>
</div>
<div id="executing-the-soil-water-balance-model" class="section level2">
<h2 class="hasAnchor">
<a href="#executing-the-soil-water-balance-model" class="anchor"></a>Executing the soil water balance model</h2>
<div id="water-balance-for-a-single-day" class="section level3">
<h3 class="hasAnchor">
<a href="#water-balance-for-a-single-day" class="anchor"></a>Water balance for a single day</h3>
<p>Soil water balance simulations will normally span periods of several months or years, but since the model operates at a daily temporal scale, it is possible to perform soil water balance for one day only. This is done using function <code><a href="../reference/spwb_day.html">spwb_day()</a></code>. In the following code we select day 100 from the meteorological input data and perform soil water balance for that day only:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">=</span> <span class="fl">100</span>
<span class="va">sd1</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/spwb_day.html">spwb_day</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">examplemeteo</span><span class="op">)</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>,  
             <span class="va">examplemeteo</span><span class="op">$</span><span class="va">MinTemperature</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>, <span class="va">examplemeteo</span><span class="op">$</span><span class="va">MaxTemperature</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>, 
             <span class="va">examplemeteo</span><span class="op">$</span><span class="va">MinRelativeHumidity</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>, <span class="va">examplemeteo</span><span class="op">$</span><span class="va">MaxRelativeHumidity</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>, 
             <span class="va">examplemeteo</span><span class="op">$</span><span class="va">Radiation</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>, <span class="va">examplemeteo</span><span class="op">$</span><span class="va">WindSpeed</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>, 
             latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>, 
             slope<span class="op">=</span> <span class="fl">0</span>, aspect <span class="op">=</span> <span class="fl">0</span>, prec <span class="op">=</span> <span class="va">examplemeteo</span><span class="op">$</span><span class="va">Precipitation</span><span class="op">[</span><span class="va">d</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>Function <code><a href="../reference/spwb_day.html">spwb_day()</a></code> is most useful when working with the complex transpiration model. This is why so many meteorological variables are required. The output of <code><a href="../reference/spwb_day.html">spwb_day()</a></code> is a list with five elements:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sd1</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "cohorts"      "WaterBalance" "Soil"         "Stand"        "Plants"</code></pre>
<ul>
<li>
<strong>cohorts</strong>: Table with the species code and species name of each cohort.</li>
<li>
<strong>WaterBalance</strong>: Contains the soil water balance flows (precipitation, infiltration, transpiration, …)</li>
<li>
<strong>Soil</strong>: Contains output values by soil layer (i.e. water evaporated from each soil layer, water transpired from each soil layer and the final soil water potential).</li>
<li>
<strong>Stand</strong>: A list with stand LAI (expanded and dead leaves), canopy water retention capacity and the proportion of light (SWR or PAR) reaching the ground.</li>
<li>
<strong>Plants</strong>: Contains output values by plant cohort (i.e. LAI values, transpiration, water potential, drought stress index, …).</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sd1</span></code></pre></div>
<pre><code>## $cohorts
##         SP              Name
## T1_157 157  Pinus halepensis
## T2_176 176      Quercus ilex
## S1_174 174 Quercus coccifera
## 
## $WaterBalance
##             PET            Rain            Snow         NetRain        Snowmelt 
##        5.023347        0.000000        0.000000        0.000000        0.000000 
##           Runon    Infiltration          Runoff    DeepDrainage SoilEvaporation 
##        0.000000        0.000000        0.000000        0.000000        0.500000 
## PlantExtraction   Transpiration 
##        1.210594        1.210594 
## 
## $Soil
##   SoilEvaporation PlantExtraction         psi
## 1    4.999998e-01       0.2402826 -0.03487639
## 2    1.529512e-07       0.9703118 -0.03442613
## 
## $Stand
##         LAI     LAIlive LAIexpanded     LAIdead          Cm  LgroundPAR 
##   1.9727123   1.9727123   1.9727123   0.0000000   1.4895748   0.3553437 
##  LgroundSWR 
##   0.4646726 
## 
## $Plants
##               LAI AbsorbedSWRFraction Transpiration GrossPhotosynthesis
## T1_157 1.00643723          0.27864285    0.63012543          2.27683706
## T2_176 0.92661573          0.24911558    0.56335249          0.83134791
## S1_174 0.03965932          0.00756893    0.01711646          0.04164607
##           PlantPsi          DDS      StemPLC
## T1_157 -0.03324984 1.449686e-06 4.582245e-07
## T2_176 -0.03324984 9.421210e-07 9.421210e-07
## S1_174 -0.03370783 6.436854e-07 7.904802e-08
## 
## attr(,"class")
## [1] "spwb_day" "list"</code></pre>
</div>
<div id="water-balance-for-multiple-days" class="section level3">
<h3 class="hasAnchor">
<a href="#water-balance-for-multiple-days" class="anchor"></a>Water balance for multiple days</h3>
<p>Most often, users will use function <code><a href="../reference/spwb.html">spwb()</a></code> to run the soil water balance model. This function requires the <code>spwbInput</code> object and the meteorological data frame. However, function <code><a href="../reference/spwb_day.html">spwb_day()</a></code> modified the state variables of the input objects. In particular, the values of soil moisture are now:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">$</span><span class="va">soil</span><span class="op">$</span><span class="va">W</span></code></pre></div>
<pre><code>## [1] 0.9891555 0.9916930</code></pre>
<p>We simply reset state variables to their default values so that new simulations are not affected by the end state of the previous simulation:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/resetInputs.html">resetInputs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">x</span><span class="op">$</span><span class="va">soil</span><span class="op">$</span><span class="va">W</span></code></pre></div>
<pre><code>## [1] 1 1</code></pre>
<p>Now we are ready to call function <code><a href="../reference/spwb.html">spwb()</a></code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">S</span> <span class="op">=</span> <span class="fu"><a href="../reference/spwb.html">spwb</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplemeteo</span>, latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></code></pre></div>
<pre><code>## Initial soil water content (mm): 185.069
## Initial snowpack content (mm): 0
## Performing daily simulations 
##  Year 2001:....................................done.
## Final soil water content (mm): 162.249
## Final snowpack content (mm): 0
## Change in soil water content (mm): -22.82
## Soil water balance result (mm): -22.82
## Change in snowpack water content (mm): 0
## Snowpack water balance result (mm): 0
## Water balance components:
##   Precipitation (mm) 513
##   Rain (mm) 462 Snow (mm) 51
##   Interception (mm) 100 Net rainfall (mm) 362
##   Infiltration (mm) 404 Runoff (mm) 9 Deep drainage (mm) 63
##   Soil evaporation (mm) 38 Transpiration (mm) 326</code></pre>
<p>Function <code><a href="../reference/spwb.html">spwb()</a></code> returns an object of class with the same name, actually a list:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "spwb" "list"</code></pre>
<p>If we inspect its elements, we realize that the output is arranged differently than in <code><a href="../reference/spwb_day.html">spwb_day()</a></code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "latitude"     "topography"   "spwbInput"    "WaterBalance" "Soil"        
## [6] "Stand"        "Plants"       "subdaily"</code></pre>
<p>In particular, element <code>spwbInput</code> contains a copy of the input parameters that were used to run the model:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">S</span><span class="op">$</span><span class="va">spwbInput</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "control"             "soil"                "canopy"             
##  [4] "cohorts"             "above"               "below"              
##  [7] "belowLayers"         "paramsPhenology"     "paramsInterception" 
## [10] "paramsTranspiration" "internalPhenology"   "internalWater"</code></pre>
<p>As before, <code>WaterBalance</code> contains water balance components, but in this case in form of a data frame with days in rows:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">S</span><span class="op">$</span><span class="va">WaterBalance</span><span class="op">)</span></code></pre></div>
<pre><code>##                  PET Precipitation      Rain Snow    NetRain Snowmelt
## 2001-01-01 1.3212770      4.869109  4.869109    0  3.2920057        0
## 2001-01-02 2.2185985      2.498292  2.498292    0  0.9563356        0
## 2001-01-03 1.8045176      0.000000  0.000000    0  0.0000000        0
## 2001-01-04 0.9200627      5.796973  5.796973    0  4.2310882        0
## 2001-01-05 2.2914449      1.884401  1.884401    0  0.6696101        0
## 2001-01-06 1.7255058     13.359801 13.359801    0 11.4937061        0
##            Infiltration Runoff DeepDrainage Evapotranspiration Interception
## 2001-01-01    3.2920057      0    2.6113540          2.3955225     1.577103
## 2001-01-02    0.9563356      0    0.6493216          2.5766241     1.541956
## 2001-01-03    0.0000000      0    0.0000000          0.6144928     0.000000
## 2001-01-04    4.2310882      0    2.1823438          2.2151420     1.565885
## 2001-01-05    0.6696101      0    0.4673639          2.2670149     1.214791
## 2001-01-06   11.4937061      0    8.3792443          2.7819304     1.866094
##            SoilEvaporation PlantExtraction Transpiration
## 2001-01-01       0.5000000       0.3184193     0.3184193
## 2001-01-02       0.5000000       0.5346680     0.5346680
## 2001-01-03       0.1796157       0.4348772     0.4348772
## 2001-01-04       0.4275280       0.2217292     0.2217292
## 2001-01-05       0.5000000       0.5522235     0.5522235
## 2001-01-06       0.5000000       0.4158359     0.4158359</code></pre>
<p>Element <code>Plants</code> is in turn a list with several dataframes with plant output variables, for example plant water potentials are in:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">S</span><span class="op">$</span><span class="va">Plants</span><span class="op">$</span><span class="va">PlantPsi</span><span class="op">)</span></code></pre></div>
<pre><code>##                 T1_157      T2_176      S1_174
## 2001-01-01 -0.03249324 -0.03249324 -0.03330650
## 2001-01-02 -0.03305830 -0.03305830 -0.03360539
## 2001-01-03 -0.03369993 -0.03369993 -0.03429369
## 2001-01-04 -0.03257571 -0.03257571 -0.03326236
## 2001-01-05 -0.03311174 -0.03311174 -0.03363392
## 2001-01-06 -0.03094718 -0.03094718 -0.03251484</code></pre>
</div>
</div>
<div id="inspecting-model-outputs" class="section level2">
<h2 class="hasAnchor">
<a href="#inspecting-model-outputs" class="anchor"></a>Inspecting model outputs</h2>
<div id="plots" class="section level3">
<h3 class="hasAnchor">
<a href="#plots" class="anchor"></a>Plots</h3>
<p>Package <code>medfate</code> provides a simple <code>plot</code> function for objects of class <code>spwb</code>. It can be used to show meteorological inputs, snow dynamics, and different components of the water balance:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span>, type <span class="op">=</span> <span class="st">"PET_Precipitation"</span><span class="op">)</span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-20-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span>, type <span class="op">=</span> <span class="st">"Snow"</span><span class="op">)</span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-20-2.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span>, type <span class="op">=</span> <span class="st">"Export"</span><span class="op">)</span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-20-3.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span>, type <span class="op">=</span> <span class="st">"Evapotranspiration"</span><span class="op">)</span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-21-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Function <code>plot</code> is also allows displaying soil moisture dynamics by layer, which can be done in four different ways (the first two only imply a change in axis units):</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"SoilTheta"</span><span class="op">)</span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-22-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"SoilRWC"</span><span class="op">)</span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-22-2.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"SoilPsi"</span><span class="op">)</span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-22-3.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"SoilVol"</span><span class="op">)</span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-22-4.png" width="672" style="display: block; margin: auto;"></p>
<p>Finally, the same function can also be used to draw the dynamics of plant variables by cohorts, such as transpiration, gross photosynthesis, water potential or drought stress:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"Transpiration"</span><span class="op">)</span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-23-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"GrossPhotosynthesis"</span><span class="op">)</span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-23-2.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"PlantPsi"</span><span class="op">)</span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-23-3.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"PlantStress"</span><span class="op">)</span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-23-4.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="general-summaries" class="section level3">
<h3 class="hasAnchor">
<a href="#general-summaries" class="anchor"></a>General summaries</h3>
<p>While the simulation model uses daily steps, users will normally be interested in outputs at larger time scales. The package provides a <code>summary</code> for objects of class <code>spwb</code>. This function can be used to summarize the model’s output at different temporal steps (i.e. weekly, annual, …). For example, to obtain the average soil moisture and water potentials by months one can use:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">S</span>, freq<span class="op">=</span><span class="st">"months"</span>,FUN<span class="op">=</span><span class="va">mean</span>, output<span class="op">=</span><span class="st">"Soil"</span><span class="op">)</span></code></pre></div>
<pre><code>##                  W.1       W.2     ML.1      ML.2    MLTot       WTD        SWE
## 2001-01-01 0.9913015 0.9980352 67.66950 116.57658 184.2461  997.7262 1.68796802
## 2001-02-01 0.9682675 0.9364257 66.09712 109.38021 175.4773 1000.0000 0.28335308
## 2001-03-01 0.9719232 0.9633419 66.34667 112.52419 178.8709  998.7720 0.01762496
## 2001-04-01 0.9454933 0.8250240 64.54248  96.36782 160.9103 1000.0000 0.59071605
## 2001-05-01 0.9447760 0.7819989 64.49352  91.34223 155.8357 1000.0000 0.00000000
## 2001-06-01 0.8176867 0.5048067 55.81799  58.96449 114.7825 1000.0000 0.00000000
## 2001-07-01 0.9513086 0.5878203 64.93946  68.66098 133.6004 1000.0000 0.00000000
## 2001-08-01 0.9595725 0.6134178 65.50357  71.65092 137.1545 1000.0000 0.00000000
## 2001-09-01 0.9610666 0.6048004 65.60557  70.64436 136.2499 1000.0000 0.00000000
## 2001-10-01 0.9737840 0.5913550 66.47370  69.07386 135.5476 1000.0000 0.00000000
## 2001-11-01 0.9693913 0.7604586 66.17384  88.82619 155.0000 1000.0000 2.68795419
## 2001-12-01 0.9354059 0.9093367 63.85388 106.21605 170.0699 1000.0000 0.00000000
##            PlantExt.1 PlantExt.2       psi.1       psi.2
## 2001-01-01 0.06862091  0.2771057 -0.03462781 -0.03347430
## 2001-02-01 0.14314093  0.5780320 -0.03927984 -0.04836369
## 2001-03-01 0.14873370  0.6006176 -0.03815044 -0.04053473
## 2001-04-01 0.18980069  0.7664371 -0.04422593 -0.09353383
## 2001-05-01 0.22402884  0.9045384 -0.04560445 -0.13481545
## 2001-06-01 0.31938419  1.0115551 -0.09582387 -1.60769546
## 2001-07-01 0.26958872  0.9251424 -0.04413189 -1.03089299
## 2001-08-01 0.27236638  1.0965811 -0.04087960 -0.43312505
## 2001-09-01 0.21376098  0.8604834 -0.04078323 -0.46204112
## 2001-10-01 0.15333136  0.6135933 -0.03801668 -0.56367102
## 2001-11-01 0.11075329  0.4467669 -0.03890918 -0.23349606
## 2001-12-01 0.10358719  0.4183059 -0.04696503 -0.05545887</code></pre>
<p>Parameter <code>output</code> is used to indicate the element of the <code>spwb</code> object for which we desire summaries. Similarly, it is possible to calculate the average stress of plant cohorts by months:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">S</span>, freq<span class="op">=</span><span class="st">"months"</span>,FUN<span class="op">=</span><span class="va">mean</span>, output<span class="op">=</span><span class="st">"PlantStress"</span><span class="op">)</span></code></pre></div>
<pre><code>##                  T1_157       T2_176       S1_174
## 2001-01-01 1.468709e-06 9.544836e-07 6.539347e-07
## 2001-02-01 4.246538e-06 2.759740e-06 1.447573e-06
## 2001-03-01 2.653684e-06 1.724576e-06 1.036851e-06
## 2001-04-01 2.762424e-05 1.795256e-05 7.136898e-06
## 2001-05-01 1.171952e-04 7.616851e-05 2.827651e-05
## 2001-06-01 1.774825e-01 1.334371e-01 5.338952e-02
## 2001-07-01 1.297993e-01 9.975341e-02 4.059602e-02
## 2001-08-01 3.031035e-03 1.972700e-03 7.141245e-04
## 2001-09-01 3.486202e-03 2.268459e-03 8.210120e-04
## 2001-10-01 8.690910e-03 5.671831e-03 2.055770e-03
## 2001-11-01 1.003865e-03 6.526789e-04 2.364025e-04
## 2001-12-01 6.345690e-06 4.123938e-06 2.270343e-06</code></pre>
<p>The <code>summary</code> function can be also used to aggregate the output by species. In this case, the values of plant cohorts belonging to the same species will be averaged using LAI values as weights. For example, we may average the daily drought stress across cohorts of the same species (here there is only one cohort by species, so this does not modify the output):</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">S</span>, freq<span class="op">=</span><span class="st">"day"</span>, output<span class="op">=</span><span class="st">"PlantStress"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##            Pinus halepensis Quercus coccifera Quercus ilex
## 2001-01-01     1.352957e-06      6.209666e-07 8.792590e-07
## 2001-01-02     1.424776e-06      6.378347e-07 9.259324e-07
## 2001-01-03     1.509357e-06      6.778349e-07 9.809000e-07
## 2001-01-04     1.363286e-06      6.185011e-07 8.859712e-07
## 2001-01-05     1.431697e-06      6.394604e-07 9.304306e-07
## 2001-01-06     1.168876e-06      5.777313e-07 7.596287e-07</code></pre>
<p>Or we can combine the aggregation by species with a temporal aggregation (here monthly averages):</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">S</span>, freq<span class="op">=</span><span class="st">"month"</span>, FUN <span class="op">=</span> <span class="va">mean</span>, output<span class="op">=</span><span class="st">"PlantStress"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>##            Pinus halepensis Quercus coccifera Quercus ilex
## 2001-01-01     1.468709e-06      6.539347e-07 9.544836e-07
## 2001-02-01     4.246538e-06      1.447573e-06 2.759740e-06
## 2001-03-01     2.653684e-06      1.036851e-06 1.724576e-06
## 2001-04-01     2.762424e-05      7.136898e-06 1.795256e-05
## 2001-05-01     1.171952e-04      2.827651e-05 7.616851e-05
## 2001-06-01     1.774825e-01      5.338952e-02 1.334371e-01
## 2001-07-01     1.297993e-01      4.059602e-02 9.975341e-02
## 2001-08-01     3.031035e-03      7.141245e-04 1.972700e-03
## 2001-09-01     3.486202e-03      8.210120e-04 2.268459e-03
## 2001-10-01     8.690910e-03      2.055770e-03 5.671831e-03
## 2001-11-01     1.003865e-03      2.364025e-04 6.526789e-04
## 2001-12-01     6.345690e-06      2.270343e-06 4.123938e-06</code></pre>
</div>
<div id="specific-output-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#specific-output-functions" class="anchor"></a>Specific output functions</h3>
<p>The package provides some functions to extract or transform specific outputs from soil plant water balance simulations. In particular, function <code><a href="../reference/spwb_stress.html">spwb_stress()</a></code> allows calculating several plant stress indices, such as the number of days with drought stress &gt; 0.5 or the maximum drought stress:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/spwb_stress.html">spwb_stress</a></span><span class="op">(</span><span class="va">S</span>, index <span class="op">=</span> <span class="st">"NDD"</span>, freq <span class="op">=</span> <span class="st">"years"</span>, draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>##            T1_157 T2_176 S1_174
## 2001-01-01      8      3      0</code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/spwb_stress.html">spwb_stress</a></span><span class="op">(</span><span class="va">S</span>, index <span class="op">=</span> <span class="st">"MDS"</span>, freq <span class="op">=</span> <span class="st">"years"</span>, draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>##               T1_157    T2_176    S1_174
## 2001-01-01 0.7018867 0.5925645 0.2583035</code></pre>
<p>As the general summary function, <code><a href="../reference/spwb_stress.html">spwb_stress()</a></code> allows calculating stress indices at several temporal scales. For example the water stress index (integral of water potential values) can be calculated and drawn for every month:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/spwb_stress.html">spwb_stress</a></span><span class="op">(</span><span class="va">S</span>, index <span class="op">=</span> <span class="st">"WSI"</span>, freq <span class="op">=</span> <span class="st">"months"</span>, draw<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="BasicWaterBalance_files/figure-html/unnamed-chunk-29-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Another specific summary function is <code><a href="../reference/spwb_waterUseEfficiency.html">spwb_waterUseEfficiency()</a></code>. This is most useful with advanced water and energy balance modeling, but for simple water balance it calculates the ratio between photosynthesis and transpiration at the desired scale. In this case it is equal to the value of the input species parameter <code>WUE</code>:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/spwb_waterUseEfficiency.html">spwb_waterUseEfficiency</a></span><span class="op">(</span><span class="va">S</span>, type <span class="op">=</span> <span class="st">"Stand Ag/E"</span>, freq <span class="op">=</span> <span class="st">"months"</span>, draw<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## 2001-01-01 2001-02-01 2001-03-01 2001-04-01 2001-05-01 2001-06-01 2001-07-01 
##   2.601888   2.601888   2.601888   2.601883   2.601860   2.570343   2.583841 
## 2001-08-01 2001-09-01 2001-10-01 2001-11-01 2001-12-01 
##   2.601350   2.601320   2.600268   2.601696   2.601887</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Miquel De Cáceres, Shengli Huang, Víctor Granda, Antoine Cabon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
