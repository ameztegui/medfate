<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced water and energy balance • medfate</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Advanced water and energy balance">
<meta property="og:description" content="medfate">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">medfate</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/emf-creaf/medfate/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="AdvancedWaterEnergyBalance_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Advanced water and energy balance</h1>
                        <h4 class="author">Miquel De Caceres</h4>
            
            <h4 class="date">2021-07-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/medfate/blob/master/vignettes/AdvancedWaterEnergyBalance.Rmd"><code>vignettes/AdvancedWaterEnergyBalance.Rmd</code></a></small>
      <div class="hidden name"><code>AdvancedWaterEnergyBalance.Rmd</code></div>

    </div>

    
    
<div id="about-this-vignette" class="section level2">
<h2 class="hasAnchor">
<a href="#about-this-vignette" class="anchor"></a>About this vignette</h2>
<p>This document describes how to run a water and energy balance model that uses a more detailed approach for hydraulics and stomatal regulation described in De Cáceres et al. (2021). This document is meant to teach users to run the simulation model within R. All the details of the model design and formulation can be found at <a href="https://emf-creaf.github.io/medfatebook/index.html" class="uri">https://emf-creaf.github.io/medfatebook/index.html</a>.</p>
</div>
<div id="preparing-model-inputs" class="section level2">
<h2 class="hasAnchor">
<a href="#preparing-model-inputs" class="anchor"></a>Preparing model inputs</h2>
<p>Model inputs are explained in greater detail in vignette ‘<em>Simulation inputs</em>’. Here we only review the different steps required to run function <code><a href="../reference/spwb.html">spwb()</a></code>.</p>
<div id="soil-vegetation-meteorology-and-species-data" class="section level3">
<h3 class="hasAnchor">
<a href="#soil-vegetation-meteorology-and-species-data" class="anchor"></a>Soil, vegetation, meteorology and species data</h3>
<p>Soil information needs to be entered as a <code>data frame</code> with soil layers in rows and physical attributes in columns. Soil physical attributes can be initialized to default values, for a given number of layers, using function <code><a href="../reference/defaultSoilParams.html">defaultSoilParams()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spar</span> <span class="op">=</span> <span class="fu"><a href="../reference/defaultSoilParams.html">defaultSoilParams</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>The soil input for water balance simulation is actually a list of class <code>soil</code> that is created using a function with the same name:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">examplesoil</span> <span class="op">=</span> <span class="fu"><a href="../reference/soil.html">soil</a></span><span class="op">(</span><span class="va">spar</span><span class="op">)</span></code></pre></div>
<p>As explained in the package overview, models included in <code>medfate</code> were primarily designed to be ran on <strong>forest inventory plots</strong>. Here we use the example object provided with the package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">exampleforestMED</span><span class="op">)</span>
<span class="va">exampleforestMED</span></code></pre></div>
<pre><code>## $ID
## [1] "1"
## 
## $patchsize
## [1] 10000
## 
## $treeData
##   Species   N   DBH Height Z50  Z95
## 1     157 168 37.55    800 750 3000
## 2     176 384 14.60    660 750 3000
## 
## $shrubData
##   Species Cover Height Z50  Z95
## 1     174  3.75     80 300 1500
## 
## $herbCover
## [1] 10
## 
## $herbHeight
## [1] 20
## 
## attr(,"class")
## [1] "forest" "list"</code></pre>
<p>Advanced water and energy balance modeling requires daily precipitation, radiation, wind speed, min/max temparatures and relative humitidy as inputs:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">examplemeteo</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">examplemeteo</span><span class="op">)</span></code></pre></div>
<pre><code>##            MeanTemperature MinTemperature MaxTemperature Precipitation
## 2001-01-01      3.57668969     -0.5934215       6.287950      4.869109
## 2001-01-02      1.83695972     -2.3662458       4.569737      2.498292
## 2001-01-03      0.09462563     -3.8541036       2.661951      0.000000
## 2001-01-04      1.13866156     -1.8744860       3.097705      5.796973
## 2001-01-05      4.70578690      0.3288287       7.551532      1.884401
## 2001-01-06      4.57036721      0.5461322       7.186784     13.359801
##            MeanRelativeHumidity MinRelativeHumidity MaxRelativeHumidity
## 2001-01-01             78.73709            65.15411           100.00000
## 2001-01-02             69.70800            57.43761            94.71780
## 2001-01-03             70.69610            58.77432            94.66823
## 2001-01-04             76.89156            66.84256            95.80950
## 2001-01-05             76.67424            62.97656           100.00000
## 2001-01-06             89.01940            74.25754           100.00000
##            Radiation WindSpeed WindDirection       PET
## 2001-01-01  12.89251  2.000000           172 1.3212770
## 2001-01-02  13.03079  7.662544           278 2.2185985
## 2001-01-03  16.90722  2.000000           141 1.8045176
## 2001-01-04  11.07275  2.000000           172 0.9200627
## 2001-01-05  13.45205  7.581347           321 2.2914449
## 2001-01-06  12.84841  6.570501           141 1.7255058</code></pre>
<p>Finally, simulations in <code>medfate</code> require a data frame with species parameter values, which we load using defaults for Catalonia (NE Spain):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"SpParamsMED"</span><span class="op">)</span></code></pre></div>
</div>
<div id="simulation-control" class="section level3">
<h3 class="hasAnchor">
<a href="#simulation-control" class="anchor"></a>Simulation control</h3>
<p>Apart from data inputs, the behaviour of simulation models is controlled using a set of global parameters. The default parameterization is obtained using function <code><a href="../reference/defaultControl.html">defaultControl()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">control</span> <span class="op">=</span> <span class="fu"><a href="../reference/defaultControl.html">defaultControl</a></span><span class="op">(</span><span class="st">"Sperry"</span><span class="op">)</span></code></pre></div>
<p>To use the complex soil water balance model we must change the values of <code>transpirationMode</code> (to switch from “Granier” to “Sperry”) and <code>soilFunctions</code> (to switch from Saxton’s retention curve, “SX”, to Van Genuchten’s retention curve, “VG”). This is automatically done when calling function <code><a href="../reference/defaultControl.html">defaultControl()</a></code> with <code>"Sperry"</code> as parameter input.</p>
</div>
<div id="water-balance-input-object" class="section level3">
<h3 class="hasAnchor">
<a href="#water-balance-input-object" class="anchor"></a>Water balance input object</h3>
<p>A last object is needed before calling simulation functions, called <code>spwbInput</code>. It consists in the compilation of aboveground and belowground parameters and the specification of additional parameter values for each plant cohort. This is done by calling function <code><a href="../reference/modelInput.html">spwbInput()</a></code>, but if one has a <code>forest</code> object, the object can be generated more directly using function <code><a href="../reference/modelInput.html">forest2spwbInput()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="../reference/modelInput.html">forest2spwbInput</a></span><span class="op">(</span><span class="va">exampleforestMED</span>, <span class="va">examplesoil</span>, <span class="va">SpParamsMED</span>, <span class="va">control</span><span class="op">)</span></code></pre></div>
<p>The <code>spwbInput</code> object for advanced water and energy balance is similar to that of simple water balance simulations, but contains more elements. Information about the cohort species is found in element <code>cohorts</code> (i.e. code, species and name):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">$</span><span class="va">cohorts</span></code></pre></div>
<pre><code>##         SP              Name
## T1_157 157  Pinus halepensis
## T2_176 176      Quercus ilex
## S1_174 174 Quercus coccifera</code></pre>
<p>Element <code>canopy</code> contains state variables within the canopy:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">$</span><span class="va">canopy</span></code></pre></div>
<pre><code>##    zlow zmid  zup Tair Cair VPair
## 1     0   50  100   NA  386    NA
## 2   100  150  200   NA  386    NA
## 3   200  250  300   NA  386    NA
## 4   300  350  400   NA  386    NA
## 5   400  450  500   NA  386    NA
## 6   500  550  600   NA  386    NA
## 7   600  650  700   NA  386    NA
## 8   700  750  800   NA  386    NA
## 9   800  850  900   NA  386    NA
## 10  900  950 1000   NA  386    NA
## 11 1000 1050 1100   NA  386    NA
## 12 1100 1150 1200   NA  386    NA
## 13 1200 1250 1300   NA  386    NA
## 14 1300 1350 1400   NA  386    NA
## 15 1400 1450 1500   NA  386    NA
## 16 1500 1550 1600   NA  386    NA
## 17 1600 1650 1700   NA  386    NA
## 18 1700 1750 1800   NA  386    NA
## 19 1800 1850 1900   NA  386    NA
## 20 1900 1950 2000   NA  386    NA
## 21 2000 2050 2100   NA  386    NA
## 22 2100 2150 2200   NA  386    NA
## 23 2200 2250 2300   NA  386    NA
## 24 2300 2350 2400   NA  386    NA
## 25 2400 2450 2500   NA  386    NA
## 26 2500 2550 2600   NA  386    NA
## 27 2600 2650 2700   NA  386    NA
## 28 2700 2750 2800   NA  386    NA</code></pre>
<p>Canopy temperature, water vapour pressure and <span class="math inline">\(CO_2\)</span> concentration are state variables needed for canopy energy balance. If the canopy energy balance assumes a single canopy layer, the same values will be assumed through the canopy. Variation of within-canopy state variables is modelled if a multi-canopy energy balance is used (see control parameter <code>multiLayerBalance</code>).</p>
<p>As you may already known, element <code>above</code> contains the aboveground structure data that we already know:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">$</span><span class="va">above</span></code></pre></div>
<pre><code>##          H        CR        N   LAI_live LAI_expanded LAI_dead
## T1_157 800 0.6605196 168.0000 1.00643723     1.006437        0
## T2_176 660 0.6055642 384.0000 0.92661573     0.000000        0
## S1_174  80 0.8032817 749.4923 0.03965932     0.000000        0</code></pre>
<p>Belowground parameters can be seen in <code>below</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">$</span><span class="va">below</span></code></pre></div>
<pre><code>##        Z50  Z95 fineRootBiomass coarseRootSoilVolume
## T1_157 750 3000       6932.8032             16.00000
## T2_176 750 3000       3171.5535             21.00000
## S1_174 300 1500        164.5287              0.09375</code></pre>
<p>and in <code>belowLayers</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">$</span><span class="va">belowLayers</span></code></pre></div>
<pre><code>## $V
##                1         2
## T1_157 0.1933638 0.8066362
## T2_176 0.1933638 0.8066362
## S1_174 0.5554389 0.4445611
## 
## $L
##                1        2
## T1_157 2392.0952 4266.582
## T2_176 2696.7961 4742.340
## S1_174  571.4173 1185.629
## 
## $VGrhizo_kmax
##                1        2
## T1_157  41629448 61920844
## T2_176  51808686 78275281
## S1_174 253152670 73383323
## 
## $VCroot_kmax
##                1         2
## T1_157 0.3944225 0.9224916
## T2_176 1.2458620 2.9554785
## S1_174 2.5460170 0.9821121
## 
## $Wpool
##        1 2
## T1_157 1 1
## T2_176 1 1
## S1_174 1 1
## 
## $RhizoPsi
##        1 2
## T1_157 0 0
## T2_176 0 0
## S1_174 0 0</code></pre>
<p>The <code>spwbInput</code>object also includes cohort parameter values for several kinds of traits. For example, plant anatomy parameters are described in <code>paramsAnatomy</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">$</span><span class="va">paramsAnatomy</span></code></pre></div>
<pre><code>##        Hmax Hmed    Al2As      SLA LeafWidth LeafDensity WoodDensity
## T1_157 1910  900 1716.262 5.348269  0.700000   0.3237865   0.6064556
## T2_176 1350  600 2481.709 6.817833  1.767436   0.5272863   0.8743066
## S1_174  250   80 6180.357 5.027918  1.376108   0.3871262   0.1713280
##        FineRootDensity conduit2sapwood      SRL RLD     r635
## T1_157       0.3237865           0.925 3172.572  10 1.964226
## T2_176       0.5272863           0.700 4066.803  10 1.805872
## S1_174       0.3871262           0.700 4066.803  10 2.289452</code></pre>
<p>Parameters related to plant transpiration and photosynthesis can be seen in <code>paramsTranspiration</code>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">$</span><span class="va">paramsTranspiration</span></code></pre></div>
<pre><code>##             Gswmin    Gswmax  Vmax298  Jmax298 Kmax_stemxylem Kmax_rootxylem
## T1_157 0.002031250 0.1940833 62.81613 128.8272      0.1500000       0.600000
## T2_176 0.006003126 0.2007222 39.24539 103.0690      0.7735834       3.094334
## S1_174 0.010455247 0.2830167 62.96065 119.4442      0.2900000       1.160000
##        VCleaf_kmax VCleaf_c  VCleaf_d VCstem_kmax VCstem_c  VCstem_d
## T1_157    7.166471 1.497782 -2.142745    1.000512 7.458883 -4.481392
## T2_176    7.354306 1.331076 -1.777291    4.523779 2.558358 -5.103492
## S1_174    9.579077 1.844224 -3.030130    3.117593 3.537784 -4.126512
##        VCroot_kmax VCroot_c  VCroot_d VGrhizo_kmax Plant_kmax
## T1_157    1.316914 1.916254 -3.240714    103550293  0.5267656
## T2_176    4.201341 1.957824 -3.366992    130083967  1.6805362
## S1_174    3.528129 1.760307 -2.797092    326535993  1.4112516</code></pre>
<p>Finally, parameters related to pressure-volume curves and water storage capacity of leaf and stem organs are in <code>paramsWaterStorage</code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">$</span><span class="va">paramsWaterStorage</span></code></pre></div>
<pre><code>##          LeafPI0   LeafEPS LeafAF     Vleaf    StemPI0   StemEPS StemAF
## T1_157 -1.591429  8.918571 0.3525 0.4560549 -2.0028552 13.185187  0.925
## T2_176 -1.483333 19.260000 0.1700 0.1829250 -3.1171155 41.465622  0.700
## S1_174 -2.370000 17.230000 0.2400 0.3846097 -0.1927245  1.218936  0.700
##         Vsapwood
## T1_157 2.8256658
## T2_176 1.1495998
## S1_174 0.1150416</code></pre>
<p>Finally, remember that one can play with plant-specific parameters for soil water balance (instead of using species-level values) by modifying manually the parameter values in this object.</p>
</div>
</div>
<div id="static-analysis-of-submodels" class="section level2">
<h2 class="hasAnchor">
<a href="#static-analysis-of-submodels" class="anchor"></a>Static analysis of submodels</h2>
<p>Before using the advanced water and energy balance model, is important to understand the parameters that influence the different sub-models. Package <code>medfate</code> provides low-level functions corresponding to sub-models (light extinction, hydraulics, transpiration, photosynthesis…). In addition, there are several high-level plotting functions that allow examining several aspects of these processes.</p>
<div id="vulnerability-curves" class="section level3">
<h3 class="hasAnchor">
<a href="#vulnerability-curves" class="anchor"></a>Vulnerability curves</h3>
<p>Given a <code>spwbInput</code> object, we can use function <code><a href="../reference/conductancefunctions.html">hydraulics_vulnerabilityCurvePlot()</a></code> to inspect <strong>vulnerability curves</strong> (i.e. how hydraulic conductance of a given segment changes with the water potential) for each plant cohort and each of the different segments of the soil-plant hydraulic network: rhizosphere, roots, stems and leaves:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/conductancefunctions.html">hydraulics_vulnerabilityCurvePlot</a></span><span class="op">(</span><span class="va">x</span>, type<span class="op">=</span><span class="st">"leaf"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-16-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/conductancefunctions.html">hydraulics_vulnerabilityCurvePlot</a></span><span class="op">(</span><span class="va">x</span>, type<span class="op">=</span><span class="st">"stem"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-16-2.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/conductancefunctions.html">hydraulics_vulnerabilityCurvePlot</a></span><span class="op">(</span><span class="va">x</span>, type<span class="op">=</span><span class="st">"root"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-16-3.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/conductancefunctions.html">hydraulics_vulnerabilityCurvePlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplesoil</span>, type<span class="op">=</span><span class="st">"rhizo"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-16-4.png" width="480" style="display: block; margin: auto;"></p>
<p>The maximum values and shape of vulnerability curves for leaves and stems are regulated by parameters in <code>paramsTranspiration</code>. Roots have vulnerability curve parameters in the same data frame, but maximum conductance values need to be specified for each soil layer and are given in <code>belowLayers$VCroot_kmax</code>. Note that the last call to <code><a href="../reference/conductancefunctions.html">hydraulics_vulnerabilityCurvePlot()</a></code> includes a <code>soil</code> object. This is because the van Genuchten parameters that define the shape of the vulnerability curve for the rhizosphere are stored in this object. Maximum conductance values in the rhizosphere are given in <code>belowLayers$VGrhizo_kmax</code>.</p>
</div>
<div id="supply-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#supply-functions" class="anchor"></a>Supply functions</h3>
<p>The vulnerability curves conformng the hydraulic network are used in the model to build the <strong>supply function</strong>, which relates water flow (i.e. transpiration) with the drop of water potential along the whole hydraulic pathway. The supply function contains not only these two variables, but also the water potential of intermediate nodes in the the hydraulic network. Function <code><a href="../reference/supplyfunctions.html">hydraulics_supplyFunctionPlot()</a></code> can be used to inspect any of this variables:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/supplyfunctions.html">hydraulics_supplyFunctionPlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplesoil</span>, type<span class="op">=</span><span class="st">"E"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-17-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/supplyfunctions.html">hydraulics_supplyFunctionPlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplesoil</span>, type<span class="op">=</span><span class="st">"ERhizo"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-17-2.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/supplyfunctions.html">hydraulics_supplyFunctionPlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplesoil</span>, type<span class="op">=</span><span class="st">"dEdP"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-17-3.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/supplyfunctions.html">hydraulics_supplyFunctionPlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplesoil</span>, type<span class="op">=</span><span class="st">"StemPsi"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-17-4.png" width="480" style="display: block; margin: auto;"></p>
<p>Calls to <code><a href="../reference/supplyfunctions.html">hydraulics_supplyFunctionPlot()</a></code> always need both a <code>spwbInput</code> object and a <code>soil</code> object. The soil moisture state (i.e. its water potential) is the starting point for the calculation of the supply function, so different curves will be obtained for different values of soil moisture.</p>
</div>
<div id="stomatal-regulation-and-photosynthesis" class="section level3">
<h3 class="hasAnchor">
<a href="#stomatal-regulation-and-photosynthesis" class="anchor"></a>Stomatal regulation and photosynthesis</h3>
<p>The soil water balance model determines stomatal conductance and transpiration separately for sunlit and shade leaves. Stomatal conductance is determined after building a photosynthesis function corresponding to the supply function and finding the value of stomatal conductance that maximizes carbon revenue while avoiding hydraulic damage (a profit-maximization approach). Given a meteorological and soil inputs and a chosen day and timestep, function <code><a href="../reference/transp_stomatalregulation.html">transp_stomatalRegulationPlot()</a></code> allows displaying the supply and photosynthesis curves for sunlit and shade leaves, along with an indication of the values corresponding to the chosen stomatal aperture:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">=</span> <span class="fl">100</span>
<span class="fu"><a href="../reference/transp_stomatalregulation.html">transp_stomatalRegulationPlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplemeteo</span>, day <span class="op">=</span> <span class="va">d</span>, timestep<span class="op">=</span><span class="fl">12</span>,
                              latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>, type<span class="op">=</span><span class="st">"E"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-18-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/transp_stomatalregulation.html">transp_stomatalRegulationPlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplemeteo</span>, day <span class="op">=</span> <span class="va">d</span>, timestep<span class="op">=</span><span class="fl">12</span>,
                              latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>, type<span class="op">=</span><span class="st">"An"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-18-2.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/transp_stomatalregulation.html">transp_stomatalRegulationPlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplemeteo</span>, day <span class="op">=</span> <span class="va">d</span>, timestep<span class="op">=</span><span class="fl">12</span>,
                              latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>, type<span class="op">=</span><span class="st">"Gsw"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-18-3.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/transp_stomatalregulation.html">transp_stomatalRegulationPlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplemeteo</span>, day <span class="op">=</span> <span class="va">d</span>, timestep<span class="op">=</span><span class="fl">12</span>,
                              latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>, type<span class="op">=</span><span class="st">"T"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-18-4.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/transp_stomatalregulation.html">transp_stomatalRegulationPlot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplemeteo</span>, day <span class="op">=</span> <span class="va">d</span>, timestep<span class="op">=</span><span class="fl">12</span>,
                              latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>, type<span class="op">=</span><span class="st">"VPD"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-18-5.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="pressure-volume-curves" class="section level3">
<h3 class="hasAnchor">
<a href="#pressure-volume-curves" class="anchor"></a>Pressure volume curves</h3>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/tissuemoisture.html">moisture_pressureVolumeCurvePlot</a></span><span class="op">(</span><span class="va">x</span>, segment<span class="op">=</span><span class="st">"leaf"</span>, fraction<span class="op">=</span><span class="st">"symplastic"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-19-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/tissuemoisture.html">moisture_pressureVolumeCurvePlot</a></span><span class="op">(</span><span class="va">x</span>, segment<span class="op">=</span><span class="st">"leaf"</span>, fraction<span class="op">=</span><span class="st">"apoplastic"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-19-2.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/tissuemoisture.html">moisture_pressureVolumeCurvePlot</a></span><span class="op">(</span><span class="va">x</span>, segment<span class="op">=</span><span class="st">"stem"</span>, fraction<span class="op">=</span><span class="st">"symplastic"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-19-3.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/tissuemoisture.html">moisture_pressureVolumeCurvePlot</a></span><span class="op">(</span><span class="va">x</span>, segment<span class="op">=</span><span class="st">"stem"</span>, fraction<span class="op">=</span><span class="st">"apoplastic"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-19-4.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="water-balance-for-a-single-day" class="section level2">
<h2 class="hasAnchor">
<a href="#water-balance-for-a-single-day" class="anchor"></a>Water balance for a single day</h2>
<div id="running-the-model" class="section level3">
<h3 class="hasAnchor">
<a href="#running-the-model" class="anchor"></a>Running the model</h3>
<p>Soil water balance simulations will normally span periods of several months or years, but since the model operates at a daily and subdaily temporal scales, it is possible to perform soil water balance for one day only. This is done using function <code><a href="../reference/spwb_day.html">spwb_day()</a></code>. In the following code we select the same day as before from the meteorological input data and perform soil water balance for that day only:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sd1</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/spwb_day.html">spwb_day</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">examplemeteo</span><span class="op">)</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>,  
             <span class="va">examplemeteo</span><span class="op">$</span><span class="va">MinTemperature</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>, <span class="va">examplemeteo</span><span class="op">$</span><span class="va">MaxTemperature</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>, 
             <span class="va">examplemeteo</span><span class="op">$</span><span class="va">MinRelativeHumidity</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>, <span class="va">examplemeteo</span><span class="op">$</span><span class="va">MaxRelativeHumidity</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>, 
             <span class="va">examplemeteo</span><span class="op">$</span><span class="va">Radiation</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>, <span class="va">examplemeteo</span><span class="op">$</span><span class="va">WindSpeed</span><span class="op">[</span><span class="va">d</span><span class="op">]</span>, 
             latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span>, 
             slope<span class="op">=</span> <span class="fl">0</span>, aspect <span class="op">=</span> <span class="fl">0</span>, prec <span class="op">=</span> <span class="va">examplemeteo</span><span class="op">$</span><span class="va">Precipitation</span><span class="op">[</span><span class="va">d</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>The output of <code><a href="../reference/spwb_day.html">spwb_day()</a></code> is a list with several elements:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sd1</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "cohorts"          "WaterBalance"     "EnergyBalance"    "Soil"            
##  [5] "Stand"            "Plants"           "RhizoPsi"         "SunlitLeaves"    
##  [9] "ShadeLeaves"      "ExtractionInst"   "PlantsInst"       "SunlitLeavesInst"
## [13] "ShadeLeavesInst"  "LightExtinction"  "LWRExtinction"    "CanopyTurbulence"</code></pre>
</div>
<div id="water-balance-output" class="section level3">
<h3 class="hasAnchor">
<a href="#water-balance-output" class="anchor"></a>Water balance output</h3>
<p>Element <code>WaterBalance</code> contains the soil water balance flows of the day (precipitation, infiltration, transpiration, …)</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sd1</span><span class="op">$</span><span class="va">WaterBalance</span></code></pre></div>
<pre><code>##                     PET                    Rain                    Snow 
##               5.0233468               0.0000000               0.0000000 
##                 NetRain                Snowmelt                   Runon 
##               0.0000000               0.0000000               0.0000000 
##            Infiltration                  Runoff            DeepDrainage 
##               0.0000000               0.0000000               0.0000000 
##         SoilEvaporation         PlantExtraction           Transpiration 
##               0.5000000               0.2873266               0.2873266 
## HydraulicRedistribution 
##               0.0000000</code></pre>
<p>And <code>Soil</code> contains water evaporated from each soil layer, water transpired from each soil layer and the final soil water potential:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sd1</span><span class="op">$</span><span class="va">Soil</span></code></pre></div>
<pre><code>##   SoilEvaporation HydraulicInput HydraulicOutput PlantExtraction         psi
## 1    4.999998e-01              0      0.08567464      0.08567464 -0.03453066
## 2    1.529512e-07              0      0.20165193      0.20165193 -0.03327137</code></pre>
</div>
<div id="soil-and-canopy-energy-balance" class="section level3">
<h3 class="hasAnchor">
<a href="#soil-and-canopy-energy-balance" class="anchor"></a>Soil and canopy energy balance</h3>
<p>Element <code>EnergyBalance</code> contains subdaily variation in atmosphere, canopy and soil temperatures, as well as canopy and soil energy balance components.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">sd1</span><span class="op">$</span><span class="va">EnergyBalance</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Temperature"         "CanopyEnergyBalance" "SoilEnergyBalance"  
## [4] "TemperatureLayers"   "VaporPressureLayers"</code></pre>
<p>Package <code>medfate</code> provides a <code>plot</code> function for objects of class <code>spwb_day</code> that can be used to inspect the results of the simulation. We use this function to display subdaily dynamics in plant, soil and canopy variables. For example, we can use it to display temperature variations (only the temperature of the topmost soil layer is drawn):</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"Temperature"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-25-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"CanopyEnergyBalance"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-25-2.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"SoilEnergyBalance"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-25-3.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="plant-output" class="section level3">
<h3 class="hasAnchor">
<a href="#plant-output" class="anchor"></a>Plant output</h3>
<p>Element <code>Plants</code> contains output values by plant cohort. Several output variables can be inspected in this element.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sd1</span><span class="op">$</span><span class="va">Plants</span></code></pre></div>
<pre><code>##             LAI Extraction Transpiration GrossPhotosynthesis NetPhotosynthesis
## T1_157 1.006437  0.2873266     0.2873266            2.275798           2.12552
## T2_176 0.000000  0.0000000     0.0000000            0.000000           0.00000
## S1_174 0.000000  0.0000000     0.0000000            0.000000           0.00000
##            RootPsi     StemPsi      StemPLC  LeafPsiMin  LeafPsiMax      dEdP
## T1_157 -0.55609740 -0.89586149 1.229325e-06 -1.38890319 -0.04744782 0.3404691
## T2_176 -0.03338608 -0.03338608 0.000000e+00 -0.03338608 -0.03338608 0.0000000
## S1_174 -0.03393955 -0.03393955 0.000000e+00 -0.03393955 -0.03393955 0.0000000
##               DDS   StemRWC   LeafRWC StemSympRWC LeafSympRWC  WaterBalance
## T1_157 0.04304872 0.9981382 0.9118023   0.9751908   0.9465707 -1.084202e-18
## T2_176 0.00000000 0.9997729 0.9978057   0.9992489   0.9983856  0.000000e+00
## S1_174 0.00000000 0.9927671 0.9986166   0.9758903   0.9982595  0.000000e+00</code></pre>
<p>While <code>Plants</code> contains one value per cohort and variable that summarizes the whole simulated day, information by disaggregated by time step can be accessed in <code>PlantsInst</code>. Moreover, we can use function <code><a href="../reference/plot.spwb_day.html">plot.spwb_day()</a></code> to draw plots of sub-daily variation per species of plant transpiration per ground area (L·m<span class="math inline">\(^{-2}\)</span>), transpiration per leaf area (also in L·m<span class="math inline">\(^{-2}\)</span>), plant net photosynthesis (in g C·m<span class="math inline">\(^{-2}\)</span>), and plant water potential (in MPa):</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"PlantTranspiration"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-27-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"TranspirationPerLeaf"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 48 row(s) containing missing values (geom_path).</code></pre>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-27-2.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"NetPhotosynthesis"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 48 row(s) containing missing values (geom_path).</code></pre>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-27-3.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafPsiAverage"</span>, bySpecies <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 48 row(s) containing missing values (geom_path).</code></pre>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-27-4.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="output-for-sunlit-and-shade-leaves" class="section level3">
<h3 class="hasAnchor">
<a href="#output-for-sunlit-and-shade-leaves" class="anchor"></a>Output for sunlit and shade leaves</h3>
<p>The model distinguishes between sunlit and shade leaves for stomatal regulation. Static properties of sunlit and shade leaves, for each cohort, can be accessed via:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sd1</span><span class="op">$</span><span class="va">SunlitLeaves</span></code></pre></div>
<pre><code>##             LAI  Vmax298 Jmax298 LeafPsiMin  LeafPsiMax     GSWMin     GSWMax
## T1_157 0.587488 46.99537  96.381  -1.693764 -0.04744782 0.00205799 0.08154347
## T2_176 0.000000      NaN     NaN   0.000000  0.00000000 0.00000000 0.00000000
## S1_174 0.000000      NaN     NaN   0.000000  0.00000000 0.00000000 0.00000000
##         TempMin  TempMax
## T1_157 2.747897 15.71633
## T2_176 0.000000  0.00000
## S1_174 0.000000  0.00000</code></pre>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sd1</span><span class="op">$</span><span class="va">ShadeLeaves</span></code></pre></div>
<pre><code>##              LAI  Vmax298  Jmax298 LeafPsiMin  LeafPsiMax      GSWMin
## T1_157 0.4189492 41.90182 85.93484  -1.034687 -0.04744782 0.002046092
## T2_176 0.0000000      NaN      NaN   0.000000  0.00000000 0.000000000
## S1_174 0.0000000      NaN      NaN   0.000000  0.00000000 0.000000000
##            GSWMax TempMin  TempMax
## T1_157 0.06514387  2.4473 11.50687
## T2_176 0.00000000  0.0000  0.00000
## S1_174 0.00000000  0.0000  0.00000</code></pre>
<p>Instantaneous values are also stored for sunlit and shade leaves. We can also use the <code>plot</code> function for objects of class <code>spwb_day</code> to draw instantaneous variations in temperature for sunlit and shade leaves:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafTemperature"</span>, bySpecies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 96 row(s) containing missing values (geom_path).</code></pre>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-29-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Note that sunlit leaves of some species reach temperatures higher than the canopy. We can also plot variations in instantaneous gross and net photosynthesis rates:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafGrossPhotosynthesis"</span>, bySpecies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 96 row(s) containing missing values (geom_path).</code></pre>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-30-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafNetPhotosynthesis"</span>, bySpecies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 96 row(s) containing missing values (geom_path).</code></pre>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-31-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Or variations in stomatal conductance:</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafStomatalConductance"</span>, bySpecies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 96 row(s) containing missing values (geom_path).</code></pre>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-32-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Or variations in vapour pressure deficit:</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafVPD"</span>, bySpecies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 96 row(s) containing missing values (geom_path).</code></pre>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-33-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Or variations in leaf water potential:</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafPsi"</span>, bySpecies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 96 row(s) containing missing values (geom_path).</code></pre>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-34-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafCi"</span>, bySpecies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 96 row(s) containing missing values (geom_path).</code></pre>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-35-1.png" width="720" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sd1</span>, type <span class="op">=</span> <span class="st">"LeafIntrinsicWUE"</span>, bySpecies<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 96 row(s) containing missing values (geom_path).</code></pre>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-36-1.png" width="720" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="water-balance-for-multiple-days" class="section level2">
<h2 class="hasAnchor">
<a href="#water-balance-for-multiple-days" class="anchor"></a>Water balance for multiple days</h2>
<div id="running-the-model-1" class="section level3">
<h3 class="hasAnchor">
<a href="#running-the-model-1" class="anchor"></a>Running the model</h3>
<p>Users will often use function <code><a href="../reference/spwb.html">spwb()</a></code> to run the soil water balance model for several days. This function requires the <code>spwbInput</code> object, the <code>soil</code> object and the meteorological data frame. However, running <code><a href="../reference/spwb_day.html">spwb_day()</a></code> modified the input objects. In particular, the soil moisture at the end of the simulation was:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">$</span><span class="va">soil</span><span class="op">$</span><span class="va">W</span></code></pre></div>
<pre><code>## [1] 0.9908718 0.9982714</code></pre>
<p>And the temperature of soil layers:</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">$</span><span class="va">soil</span><span class="op">$</span><span class="va">Temp</span></code></pre></div>
<pre><code>## [1] 9.185445 7.996657</code></pre>
<p>We can also see the current state of canopy variables:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">$</span><span class="va">canopy</span></code></pre></div>
<pre><code>##    zlow zmid  zup    Tair Cair     VPair
## 1     0   50  100 6.24811  386 0.5170718
## 2   100  150  200 6.24811  386 0.5170718
## 3   200  250  300 6.24811  386 0.5170718
## 4   300  350  400 6.24811  386 0.5170718
## 5   400  450  500 6.24811  386 0.5170718
## 6   500  550  600 6.24811  386 0.5170718
## 7   600  650  700 6.24811  386 0.5170718
## 8   700  750  800 6.24811  386 0.5170718
## 9   800  850  900 6.24811  386 0.5170718
## 10  900  950 1000 6.24811  386 0.5170718
## 11 1000 1050 1100 6.24811  386 0.5170718
## 12 1100 1150 1200 6.24811  386 0.5170718
## 13 1200 1250 1300 6.24811  386 0.5170718
## 14 1300 1350 1400 6.24811  386 0.5170718
## 15 1400 1450 1500 6.24811  386 0.5170718
## 16 1500 1550 1600 6.24811  386 0.5170718
## 17 1600 1650 1700 6.24811  386 0.5170718
## 18 1700 1750 1800 6.24811  386 0.5170718
## 19 1800 1850 1900 6.24811  386 0.5170718
## 20 1900 1950 2000 6.24811  386 0.5170718
## 21 2000 2050 2100 6.24811  386 0.5170718
## 22 2100 2150 2200 6.24811  386 0.5170718
## 23 2200 2250 2300 6.24811  386 0.5170718
## 24 2300 2350 2400 6.24811  386 0.5170718
## 25 2400 2450 2500 6.24811  386 0.5170718
## 26 2500 2550 2600 6.24811  386 0.5170718
## 27 2600 2650 2700 6.24811  386 0.5170718
## 28 2700 2750 2800 6.24811  386 0.5170718</code></pre>
<p>We simply use function <code><a href="../reference/resetInputs.html">resetInputs()</a></code> to reset state variables to their default values, so that the new simulation is not affected by the end state of the previous simulation:</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/resetInputs.html">resetInputs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">x</span><span class="op">$</span><span class="va">soil</span><span class="op">$</span><span class="va">W</span></code></pre></div>
<pre><code>## [1] 1 1</code></pre>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">$</span><span class="va">soil</span><span class="op">$</span><span class="va">Temp</span></code></pre></div>
<pre><code>## [1] NA NA</code></pre>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span><span class="op">$</span><span class="va">canopy</span></code></pre></div>
<pre><code>##    zlow zmid  zup Tair Cair VPair
## 1     0   50  100   NA  386    NA
## 2   100  150  200   NA  386    NA
## 3   200  250  300   NA  386    NA
## 4   300  350  400   NA  386    NA
## 5   400  450  500   NA  386    NA
## 6   500  550  600   NA  386    NA
## 7   600  650  700   NA  386    NA
## 8   700  750  800   NA  386    NA
## 9   800  850  900   NA  386    NA
## 10  900  950 1000   NA  386    NA
## 11 1000 1050 1100   NA  386    NA
## 12 1100 1150 1200   NA  386    NA
## 13 1200 1250 1300   NA  386    NA
## 14 1300 1350 1400   NA  386    NA
## 15 1400 1450 1500   NA  386    NA
## 16 1500 1550 1600   NA  386    NA
## 17 1600 1650 1700   NA  386    NA
## 18 1700 1750 1800   NA  386    NA
## 19 1800 1850 1900   NA  386    NA
## 20 1900 1950 2000   NA  386    NA
## 21 2000 2050 2100   NA  386    NA
## 22 2100 2150 2200   NA  386    NA
## 23 2200 2250 2300   NA  386    NA
## 24 2300 2350 2400   NA  386    NA
## 25 2400 2450 2500   NA  386    NA
## 26 2500 2550 2600   NA  386    NA
## 27 2600 2650 2700   NA  386    NA
## 28 2700 2750 2800   NA  386    NA</code></pre>
<p>Now we are ready to call function <code><a href="../reference/spwb.html">spwb()</a></code>. In this example, we only simulate 61 days to save computational time:</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">S</span> <span class="op">=</span> <span class="fu"><a href="../reference/spwb.html">spwb</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">examplemeteo</span><span class="op">[</span><span class="fl">110</span><span class="op">:</span><span class="fl">170</span>,<span class="op">]</span>, latitude <span class="op">=</span> <span class="fl">41.82592</span>, elevation <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></code></pre></div>
<pre><code>## Initial soil water content (mm): 180.814
## Initial snowpack content (mm): 0
## Performing daily simulations 
##  Year 2001:......done.
## Final soil water content (mm): 158.624
## Final snowpack content (mm): 0
## Change in soil water content (mm): -22.1896
## Soil water balance result (mm): -22.1896
## Change in snowpack water content (mm): 0
## Snowpack water balance result (mm): 0
## Water balance components:
##   Precipitation (mm) 36
##   Rain (mm) 26 Snow (mm) 10
##   Interception (mm) 4 Net rainfall (mm) 21
##   Infiltration (mm) 31 Runoff (mm) 0 Deep drainage (mm) 25
##   Soil evaporation (mm) 5 Transpiration (mm) 23
##   Plant extraction from soil (mm) 23  Plant water balance (mm) 0 Hydraulic redistribution (mm) 0</code></pre>
<p>Function <code><a href="../reference/spwb.html">spwb()</a></code> returns an object of class <em>spwb</em>. If we inspect its elements, we realize that the output is arranged differently than in <code><a href="../reference/spwb_day.html">spwb_day()</a></code>:</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "latitude"          "topography"        "spwbInput"        
##  [4] "WaterBalance"      "EnergyBalance"     "Temperature"      
##  [7] "TemperatureLayers" "Soil"              "Stand"            
## [10] "Plants"            "SunlitLeaves"      "ShadeLeaves"      
## [13] "subdaily"</code></pre>
<p>In particular, element <code>spwbInput</code> contains a copy of the input parameters that were used to run the model:</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">S</span><span class="op">$</span><span class="va">spwbInput</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "control"             "soil"                "canopy"             
##  [4] "cohorts"             "above"               "below"              
##  [7] "belowLayers"         "paramsPhenology"     "paramsAnatomy"      
## [10] "paramsInterception"  "paramsTranspiration" "paramsWaterStorage" 
## [13] "internalPhenology"   "internalWater"</code></pre>
<p>As before, <code>WaterBalance</code> contains water balance components, but in this case in form of a data frame with days in rows:</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">S</span><span class="op">$</span><span class="va">WaterBalance</span><span class="op">)</span></code></pre></div>
<pre><code>##                 PET Precipitation      Rain     Snow    NetRain Snowmelt
## 2001-04-20 2.641801     2.1625135 0.0000000 2.162513 0.00000000 0.000000
## 2001-04-21 1.875251     3.7992356 0.0000000 3.799236 0.00000000 0.000000
## 2001-04-22 2.903129     4.1962782 0.0000000 4.196278 0.00000000 2.135650
## 2001-04-23 3.633982     1.4698434 1.4698434 0.000000 0.88864031 8.022377
## 2001-04-24 3.891957     0.1538991 0.1538991 0.000000 0.09304456 0.000000
## 2001-04-25 4.171116     0.1317847 0.1317847 0.000000 0.07967460 0.000000
##            Infiltration Runoff DeepDrainage Evapotranspiration Interception
## 2001-04-20   0.00000000      0    0.0000000          0.1404533   0.00000000
## 2001-04-21   0.00000000      0    0.0000000          0.1370811   0.00000000
## 2001-04-22   2.13565015      0    1.4739337          0.1628182   0.00000000
## 2001-04-23   8.91101747      0    7.2441797          1.2782629   0.58120313
## 2001-04-24   0.09304456      0    1.4077206          0.5806587   0.06085453
## 2001-04-25   0.07967460      0    0.1356369          0.5541316   0.05211009
##            SoilEvaporation PlantExtraction Transpiration
## 2001-04-20       0.0000000       0.1404533     0.1404533
## 2001-04-21       0.0000000       0.1370811     0.1370811
## 2001-04-22       0.0000000       0.1628182     0.1628182
## 2001-04-23       0.5000000       0.1970598     0.1970598
## 2001-04-24       0.2099341       0.3098700     0.3098700
## 2001-04-25       0.1540059       0.3480156     0.3480156
##            HydraulicRedistribution
## 2001-04-20            0.000000e+00
## 2001-04-21            0.000000e+00
## 2001-04-22            0.000000e+00
## 2001-04-23            1.749974e-04
## 2001-04-24            6.313823e-06
## 2001-04-25            0.000000e+00</code></pre>
<p>Elements <code>Plants</code> is itself a list with several elements that contain daily output results by plant cohorts, for example leaf minimum (midday) water potentials are:</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">S</span><span class="op">$</span><span class="va">Plants</span><span class="op">$</span><span class="va">LeafPsiMin</span><span class="op">)</span></code></pre></div>
<pre><code>##                T1_157      T2_176      S1_174
## 2001-04-20 -0.6658485 -0.03300000 -0.03300000
## 2001-04-21 -0.6455839 -0.03312481 -0.03311431
## 2001-04-22 -0.8570124 -0.03264055 -0.03285776
## 2001-04-23 -1.0382119 -0.03167100 -0.03326086
## 2001-04-24 -1.3085054 -0.03320203 -0.03419150
## 2001-04-25 -1.4799938 -0.03366438 -0.03468467</code></pre>
</div>
<div id="plotting-and-summarizing-results" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-and-summarizing-results" class="anchor"></a>Plotting and summarizing results</h3>
<p>Package <code>medfate</code> also provides a <code>plot</code> function for objects of class <code>spwb</code>. It can be used to show the meteorological input. Additionally, it can also be used to draw soil and plant variables. In the code below we draw water fluxes, soil water potentials, plant transpiration and plant (mid-day) water potential:</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"Evapotranspiration"</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-46-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"SoilPsi"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-46-2.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"PlantTranspiration"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-46-3.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">S</span>, type<span class="op">=</span><span class="st">"LeafPsiMin"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 98 row(s) containing missing values (geom_path).</code></pre>
<p><img src="AdvancedWaterEnergyBalance_files/figure-html/unnamed-chunk-46-4.png" width="672" style="display: block; margin: auto;"></p>
<p>While the simulation model uses daily steps, users may be interested in outputs at larger time scales. The package provides a <code>summary</code> for objects of class <code>spwb</code>. This function can be used to summarize the model’s output at different temporal steps (i.e. weekly, annual, …). For example, to obtain the average soil moisture and water potentials by months one can use:</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">S</span>, freq<span class="op">=</span><span class="st">"months"</span>,FUN<span class="op">=</span><span class="va">mean</span>, output<span class="op">=</span><span class="st">"Soil"</span><span class="op">)</span></code></pre></div>
<pre><code>##                  W.1       W.2     ML.1     ML.2    MLTot       WTD      SWE
## 2001-04-01 0.9880225 0.9989028 63.39231 116.5250 179.9173  997.0313 1.467876
## 2001-05-01 0.9613607 0.9783624 61.68166 114.1289 175.8105  998.3447 0.000000
## 2001-06-01 0.8978596 0.9114256 57.60739 106.3205 163.9279 1000.0000 0.000000
##            PlantExt.1 PlantExt.2 HydraulicInput.1 HydraulicInput.2       psi.1
## 2001-04-01 0.07370447  0.1745407     1.648284e-05                0 -0.03554050
## 2001-05-01 0.10642467  0.2528895     9.116318e-06                0 -0.04065522
## 2001-06-01 0.14806034  0.3506224     3.229317e-06                0 -0.05655932
##                  psi.2
## 2001-04-01 -0.03333797
## 2001-05-01 -0.03704300
## 2001-06-01 -0.05125922</code></pre>
<p>Parameter <code>output</code> is used to indicate the element of the <code>spwb</code> object for which we desire summaries. Similarly, it is possible to calculate the average stress of plant cohorts by months:</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">S</span>, freq<span class="op">=</span><span class="st">"months"</span>,FUN<span class="op">=</span><span class="va">mean</span>, output<span class="op">=</span><span class="st">"PlantStress"</span><span class="op">)</span></code></pre></div>
<pre><code>##                T1_157      T2_176     S1_174
## 2001-04-01 0.03446150 0.000000000 0.00000000
## 2001-05-01 0.05042729 0.000000000 0.00000000
## 2001-06-01 0.06590681 0.005218579 0.00254478</code></pre>
<p>The <code>summary</code> function can be also used to aggregate the output by species. In this case, the values of plant cohorts belonging to the same species will be averaged using LAI values as weights. For example, we may average the daily drought stress across cohorts of the same species (here there is only one cohort by species, so this does not modify the output):</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">S</span>, freq<span class="op">=</span><span class="st">"day"</span>, output<span class="op">=</span><span class="st">"PlantStress"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##            Pinus halepensis Quercus coccifera Quercus ilex
## 2001-04-20       0.01714144                NA           NA
## 2001-04-21       0.01841210                NA           NA
## 2001-04-22       0.02110329                NA           NA
## 2001-04-23       0.02371806                NA           NA
## 2001-04-24       0.03916279                NA           NA
## 2001-04-25       0.05134232                NA           NA</code></pre>
<p>Or we can combine the aggregation by species with a temporal aggregation (here monthly averages):</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">S</span>, freq<span class="op">=</span><span class="st">"month"</span>, FUN <span class="op">=</span> <span class="va">mean</span>, output<span class="op">=</span><span class="st">"PlantStress"</span>, bySpecies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>##            Pinus halepensis Quercus coccifera Quercus ilex
## 2001-04-01       0.03446150                NA           NA
## 2001-05-01       0.05042729                NA           NA
## 2001-06-01       0.06590681                NA           NA</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Miquel De Cáceres, Shengli Huang, Víctor Granda, Antoine Cabon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
