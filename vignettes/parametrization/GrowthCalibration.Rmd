---
title: "Growth calibration"
author: "Miquel De CÃ¡ceres"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_document:
    toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
library(knitr)
library(ggplot2)
library(cowplot)
library(sensitivity)
library(tidyverse)

base_calibration = "~/OneDrive/Professional/MedfateWorks/GrowthCalibration/"
```

## Introduction

### Goals

  The growth model included in **medfate** implements processes regulating plant carbon balance and growth. Parameter values for these processes are obtained from: (a) global functional trait databases; (b) meta-modelling exercises; (c) model calibration exercises. The main goal of the current exercise is to obtain suitable values (via model calibration) for parameters related with the maintenance respiration costs, formation rates and senescence rates of sapwood, because these are difficult to obtain using other means. At the same time, the exercise provides information on the performance of the model to predict secondary growth at the tree and stand levels.

### Data

 * 90 permanent forest plots (15 plots per dominant species). 
 * Dominant species are Fagus sylvatica, Pinus halepensis, Pinus nigra, Pinus sylvestris, Quercus pubescens and Quercus ilex.
 * IFN data (IFN3-IFN4)
 * Dendrological ring width measurements of up to 6 trees per plot. Measurements not available for Quercus ilex. 
 * Weather data from interpolation using meteoland (2001 - 2015).
 * Soil data from soil grids (could be replaced with local samples).
 * Local measurements for sampled trees: Al2As, Ks, Ptlp, SLA (2015).

```{r, echo = FALSE}
plot_desc = readRDS(paste0(base_calibration,"Rdata/plot_desc_FUN2FUN.rds"))
plot_desc$targetName = as.character(plot_desc$targetName)
plot_desc$targetName[plot_desc$targetName=="Quercus humilis"] = "Quercus pubescens"

obs_FUN2FUN = readRDS(paste0(base_calibration,"Rdata/obs_FUN2FUN_IFN.rds"))
plot_desc$meanBAI = NA
plot_desc$sdBAI = NA
for(i in 1:length(obs_FUN2FUN)) {
  obs_i = obs_FUN2FUN[[i]]
  if(!is.null(obs_i)) {
    plot_desc$meanBAI[i] = mean(apply(obs_i[,-1, drop =FALSE],2,mean, na.rm=T), na.rm=T)
    plot_desc$sdBAI[i] = mean(apply(obs_i[,-1, drop =FALSE],2,sd, na.rm=T), na.rm=T)
  }
}

eval_df = readRDS(paste0(base_calibration,"Rdata/eval_FUN2FUN.rds"))

cal_FUN2FUN_SL_ga = readRDS(paste0(base_calibration,"Rdata/cal_FUN2FUN_SL_ga.rds"))
cal_FUN2FUN_SL_ga$Species = as.character(cal_FUN2FUN_SL_ga$Species)
cal_FUN2FUN_SL_ga$Species[cal_FUN2FUN_SL_ga$Species=="Quercus humilis"] = "Quercus pubescens"
cal_FUN2FUN_SL_ga$MeanBAI = plot_desc$meanBAI
cal_FUN2FUN_SL_ga$relvalue_cal = 100*cal_FUN2FUN_SL_ga$value_cal/plot_desc$meanBAI

cal_FUN2FUN_NSL_ga = readRDS(paste0(base_calibration,"Rdata/cal_FUN2FUN_NSL_ga.rds"))
cal_FUN2FUN_NSL_ga$Species = as.character(cal_FUN2FUN_NSL_ga$Species)
cal_FUN2FUN_NSL_ga$Species[cal_FUN2FUN_NSL_ga$Species=="Quercus humilis"] = "Quercus pubescens"
cal_FUN2FUN_NSL_ga$MeanBAI = plot_desc$meanBAI
cal_FUN2FUN_NSL_ga$relvalue_cal = 100*cal_FUN2FUN_NSL_ga$value_cal/plot_desc$meanBAI
eval_df$Obs_BAI = plot_desc$meanBAI
eval_df$MAErel_uncalibrated = 100*eval_df$MAE_uncalibrated/plot_desc$meanBAI
eval_df$MAErel_calibrated_sl = 100*eval_df$MAE_calibrated_sl/plot_desc$meanBAI

cal_FUN2FUN_SL_ga$Group = "Gymnosperm"
cal_FUN2FUN_SL_ga$Group[cal_FUN2FUN_SL_ga$Species %in% c("Fagus sylvatica", "Quercus pubescens")] = "Angiosperm"

cal_FUN2FUN_NSL_ga$Group = cal_FUN2FUN_SL_ga$Group
```

### Target parameters for calibration

  a. **Sapwood daily respiration rate (RERsapwood)** - Used to modulate maintenance respiration demands of living sapwood tissues (parenchyma, cambium, phloem, etc.), which in large trees may also represent a large fraction of maintenance respiration.
  b. **Sapwood maximum growth rate (RGRsapwoodmax)** - Used to modulate maximum daily sapwood growth rates (relative to current sapwood area). Actual relative growth rates include temperature and sink limitations to growth.
  c. **Sapwood daily senescence rate (SRsapwood)** - Used to determine the daily proportion of sapwood that becomes heartwood. It regulates the area of functional sapwood, together with the sapwood maximum growth rate.
  
### Sensitivity analysis

Response function final basal area of a IFN3 plot of *Pinus sylvestris* (a single cohort), after simulating growth between 2001 and 2005, as a function of the target parameters, as well as some others.

```{r SA_variance_plot, echo=FALSE, fig.width=6, fig.height=5}
sens_var_finalBA = readRDS(paste0(base_calibration,"Rdata/sens_finalBA_variance_FUN2FUN.rds"))
parNames = c("rfc@2","RERleaf","RERsapwood","RGRleafmax","RGRsapwoodmax", "SRsapwood", "conduit2sapwood", "Al2As","WUE")
row.names(sens_var_finalBA$S) = parNames
row.names(sens_var_finalBA$T) = parNames

p1<-ggplot(sens_var_finalBA, choice=1)+
    labs(title = "Final basal area")+
    theme(axis.text.x = element_text(angle = 30, vjust = 1, 
                                     face = "plain", size = 9,
                                     hjust=1),
          axis.text.y = element_text(face="plain", size = 9),
          legend.background = element_blank())
p1
```

The variable that primarily determines growth rate is WUE, which, together with the transpiration rate determines carbon availability. Sink limitations may also be operating


```{r SA_variance_cvBAI_plot, echo=FALSE, fig.width=6, fig.height=5}
sens_var_cvBAI = readRDS(paste0(base_calibration,"Rdata/sens_cvBAI_variance_FUN2FUN.rds"))
row.names(sens_var_cvBAI$S) = parNames
row.names(sens_var_cvBAI$T) = parNames

p2<-ggplot(sens_var_cvBAI, choice=1)+
    labs(title="BAI coefficient of variation")+
    theme(axis.text.x = element_text(angle = 30, vjust = 1, 
                                     face = "plain", size = 9,
                                     hjust=1),
          axis.text.y = element_text(face="plain", size = 9),
          legend.background = element_blank())
p2
```

### Calibration procedure

For each forest plot, we matched each dendrochronological series with a tree cohort by finding which tree (in the IFN3 sampling) had the DBH most similar to that estimated from the dendrochronology at year 2000. Then, we took the series of annual basal area increments (BAI) as the observations to be matched by model growth predictions for the matched tree cohort.  We calibrated the target parameters for the target dominant species using a genetic algorithm. Model parameter values were assumed to be the same for all cohorts of the target species. The remaining species in the plot were given default constant parameter values. The objective function for the genetic algorithm was the mean across cohorts with BAI observations, of the mean absolute error (MAE) resulting from comparing observed and predicted annual BAI.

## Calibration results

```{r, echo = FALSE}
cal_FUN2FUN_SL_ga$Species = as.character(cal_FUN2FUN_SL_ga$Species)
sel = !is.na(cal_FUN2FUN_SL_ga$value_cal)
cal_FUN2FUN_SL_ga = cal_FUN2FUN_SL_ga[sel,,drop=FALSE]
cal_FUN2FUN_NSL_ga = cal_FUN2FUN_NSL_ga[sel,,drop=FALSE]
eval_df = eval_df[sel, ,drop = FALSE]

plot_desc = plot_desc[row.names(cal_FUN2FUN_SL_ga),,drop=FALSE]
cal_FUN2FUN_SL_ga$P.PET_SpringSummer = plot_desc$P.PET_SpringSummer
cal_FUN2FUN_SL_ga$P.PET_Summer = plot_desc$P.PET_Summer
```

### Error

```{r cal_SL_sp, echo = FALSE}
MAE_cal = cal_FUN2FUN_SL_ga$value_cal
wmean <-function(x, na.rm = TRUE) {
  median(x, na.rm = na.rm)
}
ms = cbind(apply(cal_FUN2FUN_SL_ga[,c(12,2,3,13)],2,function(x) {tapply(x, cal_FUN2FUN_SL_ga$Species, mean, na.rm=T)}),
          apply(cal_FUN2FUN_SL_ga[,c(5,7,9,11)],2,function(x) {tapply(x, cal_FUN2FUN_SL_ga$Species, wmean, na.rm=T)}))
mg = cbind(apply(cal_FUN2FUN_SL_ga[,c(12,2,3,13)],2,function(x) {tapply(x, cal_FUN2FUN_SL_ga$Group, mean, na.rm=T)}),
          apply(cal_FUN2FUN_SL_ga[,c(5,7,9,11)],2,function(x) {tapply(x, cal_FUN2FUN_SL_ga$Group, wmean, na.rm=T)}))
dfs<-data.frame(Nplots = tapply(cal_FUN2FUN_SL_ga$value_ini, cal_FUN2FUN_SL_ga$Species, function(x){sum(!is.na(x))}))
dfs <- cbind(dfs, ms)
dfg<-data.frame(Nplots = tapply(cal_FUN2FUN_SL_ga$value_ini, cal_FUN2FUN_SL_ga$Group, function(x){sum(!is.na(x))}))
dfg <- cbind(dfg, mg)
df <- rbind(dfs, dfg)
names(df) <-  c("N", "MeanBAI","MAE", "MAEcal", "relMAEcal","RERsapwood","RGRsapwoodmax", "SRsapwood", "rfc@2")
N_tot = sum(dfs$Nplots)
ma <- c(N_tot,
        apply(cal_FUN2FUN_SL_ga[,c(12,2,3,13)],2,mean, na.rm=TRUE),
        apply(cal_FUN2FUN_SL_ga[,c(5,7,9,11)],2,wmean, na.rm=TRUE))
df <- rbind(df, ma)
row.names(df)[nrow(df)] = "All"
df[,c("N", "MeanBAI", "MAE", "MAEcal", "relMAEcal")] %>%
  kbl() %>%
  kable_styling()
```

Results of calibration for each plot:

```{r, echo = FALSE, fig.width=8, fig.height=4}
p1<-ggplot(cal_FUN2FUN_SL_ga)+
  geom_boxplot(aes(x=Species, y=value_cal, fill=Species))+
  labs(x="", y="MAE")+
  scale_fill_discrete(NULL)+
  theme_bw()+theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
                   legend.position = "none")
p2<-ggplot(cal_FUN2FUN_SL_ga)+
  geom_boxplot(aes(x=Species, y=relvalue_cal, fill=Species))+
  labs(x="", y="relMAE")+
  scale_fill_discrete(NULL)+
  theme_bw()+theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
                   legend.position = "none")
p <- plot_grid(p1,p2, nrow=1)
p
```

### Parameter distribution

Summary of parameters by species:

```{r echo = FALSE}
df[,c("RERsapwood", "RGRsapwoodmax", "SRsapwood", "rfc@2")] %>%
  kbl() %>%
  kable_styling()
```


```{r, echo = FALSE}
df = cal_FUN2FUN_SL_ga
```

```{r, echo = FALSE}
anova(aov(RGRsapwoodmax_cal~Species, data = df))
```

```{r, echo = FALSE}
anova(aov(RERsapwood_cal~Species, data = df))
```

```{r, echo = FALSE}
anova(aov(SRsapwood_cal~Species, data = df))
```


```{r, echo = FALSE}
anova(aov(rfc_cal~Species, data = df))
```

```{r, echo = FALSE, fig.width=7, fig.height=7}
p3<-ggplot(df)+
  geom_boxplot(aes(x=Species, y=RERsapwood_cal, fill = Species))+
  labs(x="", y="RER sapwood")+
  theme_bw()+theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
                   legend.position = "none")
p4<-ggplot(df)+
  geom_boxplot(aes(x=Species, y=RGRsapwoodmax_cal, fill = Species))+
  labs(x="", y="RGR sapwood")+
  theme_bw()+theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
                   legend.position = "none")
p5<-ggplot(df)+
  geom_boxplot(aes(x=Species, y=SRsapwood_cal, fill = Species))+
  ylim(c(0.00001,0.00025))+
  labs(x="", y="Sapwood senescence rate")+
  scale_fill_discrete("")+
  theme_bw()+theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
                   legend.position = "none")
p6<-ggplot(df)+
  geom_boxplot(aes(x=Species, y=rfc_cal, fill = Species))+
  ylim(c(25,95))+
  labs(x="", y="Rock content (%)")+
  theme_bw()+theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
                   legend.position = "none")
p<-plot_grid(p3,p4, p5, p6, labels=c("a", "b", "c","d"), nrow=2)
p
```

### Parameter covariances

```{r, echo = FALSE, fig.height=12, fig.width=10}
g1<-ggplot(cal_FUN2FUN_SL_ga)+
  geom_point(aes(x=RERsapwood_cal, y = RGRsapwoodmax_cal, col=Species, shape = Species))+
  theme_bw()
g2<-ggplot(cal_FUN2FUN_SL_ga)+
  geom_point(aes(x=RERsapwood_cal, y = SRsapwood_cal, col=Species, shape = Species))+
  theme_bw()
g3<-ggplot(cal_FUN2FUN_SL_ga)+
  geom_point(aes(x=RERsapwood_cal, y = rfc_cal, col=Species, shape = Species))+
  theme_bw()
g4<-ggplot(cal_FUN2FUN_SL_ga)+
  geom_point(aes(x=SRsapwood_cal, y = RGRsapwoodmax_cal, col=Species, shape = Species))+
  theme_bw()
g5<-ggplot(cal_FUN2FUN_SL_ga)+
  geom_point(aes(x=rfc_cal, y = RGRsapwoodmax_cal, col=Species, shape = Species))+
  theme_bw()
g6<-ggplot(cal_FUN2FUN_SL_ga)+
  geom_point(aes(x=rfc_cal, y = SRsapwood_cal, col=Species, shape = Species))+
  theme_bw()
plot_grid(g1,g2,g3,g4,g5,g6, ncol=2)
```


### Comparison between considering sink limitation or not
```{r, echo = FALSE}
cal_FUN2FUN_SL_ga$type="Calibration with SL"
cal_FUN2FUN_NSL_ga$type="Calibration without SL"
cal_FUN2FUN = bind_rows(cal_FUN2FUN_SL_ga, cal_FUN2FUN_NSL_ga)
```

#### Error
```{r, echo = FALSE}
anova(aov(value_cal~Species*type, data = cal_FUN2FUN))
```
```{r, echo = FALSE}
anova(aov(relvalue_cal~Species*type, data = cal_FUN2FUN))
```

```{r, echo = FALSE, fig.width=8, fig.height=4}
p1<-ggplot(cal_FUN2FUN)+
  geom_boxplot(aes(x=Species, y=value_cal, fill=type))+
  labs(x="", y="MAE")+
  scale_fill_discrete(NULL)+
  theme_bw()+theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
                   legend.position = c(0.60,0.85))
p2<-ggplot(cal_FUN2FUN)+
  geom_boxplot(aes(x=Species, y=relvalue_cal, fill=type))+
  labs(x="", y="relMAE")+
  scale_fill_discrete(NULL)+
  theme_bw()+theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
                   legend.position = c(0.30,0.85))
p <- plot_grid(p1,p2, nrow=1)
p
```



```{r, echo = FALSE, fig.width = 8, fig.height = 4}
df = data.frame(Species = cal_FUN2FUN_SL_ga$Species, 
                MAE_SL = cal_FUN2FUN_SL_ga$value_cal,
                MAE_NSL = cal_FUN2FUN_NSL_ga$value_cal)
p1<-ggplot(df)+
  geom_point(aes(x=MAE_SL, y = MAE_NSL, col=Species, shape = Species))+
  xlab("MAE including sink limitation")+ 
  ylab("MAE without sink limitation")+
  geom_abline(slope=1, intercept= 0)+
  xlim(c(0,50))+ ylim(c(0,50))+
  theme_bw() +  theme(legend.position = c(0.75,0.25), 
                      legend.title = element_text(size=9),
                      legend.text = element_text(size = 9, face = "italic"),
                      legend.background = element_blank())
df = data.frame(Species = cal_FUN2FUN_SL_ga$Species, 
                relMAE_SL = cal_FUN2FUN_SL_ga$relvalue_cal,
                relMAE_NSL = cal_FUN2FUN_NSL_ga$relvalue_cal)
p2<-ggplot(df)+
  geom_point(aes(x=relMAE_SL, y = relMAE_NSL, col=Species, shape = Species))+
  xlab("relMAE including sink limitation")+ 
  ylab("relMAE without sink limitation")+
  geom_abline(slope=1, intercept= 0)+
  xlim(c(0,500))+ ylim(c(0,500))+
  theme_bw() +  theme(legend.position = c(0.75,0.25), 
                      legend.title = element_text(size=9),
                      legend.text = element_text(size = 9, face = "italic"),
                      legend.background = element_blank())
p <- plot_grid(p1,p2, nrow=1)
p
```

#### Parameter distribution

```{r, echo = FALSE}
anova(aov(RERsapwood_cal~Species*type, data = cal_FUN2FUN))
```
```{r, echo = FALSE}
anova(aov(RGRsapwoodmax_cal~Species*type, data = cal_FUN2FUN))
```
```{r, echo = FALSE}
anova(aov(SRsapwood_cal~Species*type, data = cal_FUN2FUN))
```
```{r, echo = FALSE}
anova(aov(rfc_cal~Species*type, data = cal_FUN2FUN))
```


```{r, echo = FALSE, fig.width=8, fig.height=7}
p3<-ggplot(cal_FUN2FUN)+
  geom_boxplot(aes(x=Species, y=RERsapwood_cal, fill = type))+
  labs(x="", y="RER sapwood")+
  theme_bw()+theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
                   legend.position = "none")
p4<-ggplot(cal_FUN2FUN)+
  geom_boxplot(aes(x=Species, y=RGRsapwoodmax_cal, fill = type))+
  labs(x="", y="RGR sapwood")+
  theme_bw()+theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
                   legend.position = "none")
p5<-ggplot(cal_FUN2FUN)+
  geom_boxplot(aes(x=Species, y=SRsapwood_cal, fill=type))+
  ylim(c(0.00001,0.00025))+
  labs(x="", y="Sapwood senescence rate")+
  scale_fill_discrete("")+
  theme_bw()+theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
                   legend.position = "none")
p6<-ggplot(cal_FUN2FUN)+
  geom_boxplot(aes(x=Species, y=rfc_cal, fill=type))+
  ylim(c(25,95))+
  labs(x="", y="Rock content (%)")+
  theme_bw()+theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
                   legend.position = "none")
plot_grid(p3,p4,p5,p6, nrow=2)
```

## Final evaluation

```{r, echo = FALSE}
eval_df = eval_df[!is.na(eval_df$MAE_uncalibrated),, drop=FALSE]
```

### Annual BAI
Annual BAI evaluation results by plot:
```{r echo = FALSE, eval = TRUE}
df = data.frame(Species = eval_df$Species,
                OBS = eval_df$Obs_BAI,
                MAE_unc = eval_df$MAE_uncalibrated,
                MAE_cal = eval_df$MAE_calibrated_sl,
                MAErel_unc = eval_df$MAErel_uncalibrated,
                MAErel_cal = eval_df$MAErel_calibrated_sl,
                row.names = row.names(eval_df))
df %>%
  kbl() %>%
  kable_styling()
```

Annual BAI evaluation results by species (medians):

```{r echo = FALSE, eval = TRUE}
eval_df %>% group_by(Species) %>% 
  summarise(OBS = median(Obs_BAI, na.rm=T),
            MAE_unc = median(MAE_uncalibrated, na.rm=T),
            MAE_cal = median(MAE_calibrated_sl, na.rm=T),
            MAErel_unc = median(MAErel_uncalibrated, na.rm=T),
            MAErel_cal = median(MAErel_calibrated_sl, na.rm=T)) %>% 
  kbl() %>%
  kable_styling()
```

```{r, echo = FALSE, eval = TRUE, fig.width=4, fig.height=3.5}
eval_def_df = eval_df[,c("Species", "MAE_uncalibrated", "MAErel_uncalibrated","MAE_BAItot_uncalibrated", "MAErel_BAItot_uncalibrated")]
names(eval_def_df)<-c("Species", "MAE_BAI", "MAErel_BAI","MAE_BAItot", "MAErel_BAItot")

eval_cal_df = eval_df[,c("Species", "MAE_calibrated_sl", "MAErel_calibrated_sl","MAE_BAItot_calibrated_sl", "MAErel_BAItot_calibrated_sl")]
names(eval_cal_df)<-names(eval_def_df)

eval_def_df$type = "Default parameters"
eval_cal_df$type = "Calibrated"

eval_all_df = bind_rows(eval_def_df,eval_cal_df)
```

```{r, eval = TRUE, echo = FALSE}
p1<-ggplot(eval_all_df)+
  geom_boxplot(aes(x=Species, y=MAE_BAI, fill=type))+
  labs(x="", y="MAE(annual BAI)")+
  scale_fill_discrete(NULL)+
  ylim(c(0,50))+
  theme_bw()+theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
                   legend.position = c(0.8,0.80))
p1
```

```{r, eval = TRUE, echo = FALSE}
p2<-ggplot(eval_all_df)+
  geom_boxplot(aes(x=Species, y=MAErel_BAI, fill=type))+
  labs(x="", y="MAE(relative annual BAI)")+
  scale_fill_discrete(NULL)+
  ylim(c(0, 200))+
  theme_bw()+theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
                   legend.position = c(0.8,0.80))
p2
```


### Total BAI

Evaluation of total BAI during the 15 years:

```{r echo = FALSE, eval = TRUE}
df = data.frame(Species = eval_df$Species,
                OBS = eval_df$Obs_BAItot,
                MAE_unc = eval_df$MAE_BAItot_uncalibrated,
                MAE_cal = eval_df$MAE_BAItot_calibrated_sl,
                MAErel_unc = eval_df$MAErel_BAItot_uncalibrated,
                MAErel_cal = eval_df$MAErel_BAItot_calibrated_sl,
                row.names = row.names(eval_df))
df %>%
  kbl() %>%
  kable_styling()
```

Summary by species (medians)
```{r echo = FALSE, eval = TRUE}
eval_df %>% group_by(Species) %>% 
  summarise(OBS = median(Obs_BAItot, na.rm=T),
            MAE_unc = median(MAE_BAItot_uncalibrated, na.rm=T),
            MAE_cal = median(MAE_BAItot_calibrated_sl, na.rm=T),
            MAErel_unc = median(MAErel_BAItot_uncalibrated, na.rm=T),
            MAErel_cal = median(MAErel_BAItot_calibrated_sl, na.rm=T)) %>% 
  kbl() %>%
  kable_styling()
```



```{r eval = TRUE, echo = FALSE}
p3<-ggplot(eval_all_df)+
  geom_boxplot(aes(x=Species, y=MAE_BAItot, fill=type))+
  labs(x="", y="MAE(total BAI)")+
  scale_fill_discrete(NULL)+
  ylim(c(0,500))+
  theme_bw()+theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
                   legend.position = c(0.8,0.80))
p3
```


```{r, eval = TRUE, echo = FALSE}
p4<-ggplot(eval_all_df)+
  geom_boxplot(aes(x=Species, y=MAErel_BAItot, fill=type))+
  labs(x="", y="MAE(relative total BAI)")+
  scale_fill_discrete(NULL)+
  ylim(c(0, 200))+
  theme_bw()+theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust=1),
                   legend.position = c(0.8,0.80))
p4
```


